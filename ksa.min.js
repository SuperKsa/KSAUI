function debug(data){console.log.apply(this,arguments)}var consoleGroupN={};function debugTime(key){consoleGroupN[key]=consoleGroupN[key]>=0?consoleGroupN[key]+1:0;key=key+"-"+consoleGroupN[key];console.time(key);return function(){console.timeEnd(key)}}(function(document,undefined,K){"use strict";var bindEventData={};function eventAddstopPropagation(events){if(events){events.isStop=false;events.stop=function(){this.stopPropagation();this.preventDefault();this.isStop=true}}return events}var wrapMap={thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};wrapMap.tbody=wrapMap.tfoot=wrapMap.colgroup=wrapMap.caption=wrapMap.thead;wrapMap.th=wrapMap.td;var rtagName=/<([a-z][^\/\0>\x20\t\r\n\f]*)/i;function createDom(code,isEle){var fragment=document.createDocumentFragment();var tag=(rtagName.exec(code)||["",""])[1].toLowerCase();var wrap=wrapMap[tag]||wrapMap._default;var dom=fragment.appendChild(document.createElement("div"));dom.innerHTML=wrap[1]+code+wrap[2];var j=wrap[0];while(j--){dom=dom.lastChild}var globalScriptEvent={},scriptLoadCallback={},scriptSrcLast,scriptSrcLastID;$(dom).find("script").map(function(ele){var script=document.createElement("script");$.loop($.attrs(ele),function(v,k){script[k]=v});var scriptID=$.objectID(script);if(ele.src){scriptLoadCallback[scriptID]=ele;script.onload=function(){delete scriptLoadCallback[scriptID];if($.isEmpty(scriptLoadCallback)){$.loop(globalScriptEvent[scriptID],function(elArr){elArr[0].text=elArr[1]})}};scriptSrcLast=script;scriptSrcLastID=scriptID}if(scriptSrcLastID){if(ele.text){globalScriptEvent[scriptSrcLastID]=globalScriptEvent[scriptSrcLastID]?globalScriptEvent[scriptSrcLastID]:[];globalScriptEvent[scriptSrcLastID].push([script,ele.text])}}else{script.text=ele.text}$(ele).after(script).remove()});var eles=[];$.loop(dom.childNodes,function(e){if(!isEle||e.nodeType!==3&&e.nodeType!==8){eles.push(e)}});return eles}$.getScript=function(url,callFun){var script=document.createElement("script");script.src=url;script.onload=function(){callFun&&callFun()};$("head").append(script)};$.getCSS=function(url,callFun){var script=document.createElement("link");script.rel="stylesheet";script.type="text/css";script.href=url;script.onload=function(){callFun&&callFun()};$("head").append(script)};function tempDom(code,callback,reOrder){var dom;var isFunc=$.isFunction(code);if(code instanceof $){dom=code}else if($.isDomAll(code)){dom=code instanceof NodeList?code:[code]}else if($.isArray(code)){dom=code}else if($.isString(code)){dom=createDom(code)}var length=this.length;$.loop(this,function(ele,index){var isClone=index!==length-1;if(isFunc){dom=code.call(ele,index,ele.innerHTML);if($.isString(dom)){dom=createDom(dom);isClone=0}if(dom instanceof $){dom=[dom[0]];isClone=0}else if(dom instanceof HTMLElement||dom instanceof Node){isClone=0}dom=$.toArray(dom)}var n=!reOrder?dom.length:0;var i=reOrder?dom.length-1:0;while(reOrder?i>=0:i<n){var eles=dom[i];eles=!isClone?eles:$(eles).clone(true,true)[0];callback.call(ele,ele,eles);reOrder?i--:i++}});return this}function isSelectDom(ele,selector){if(!selector||!ele||ele.nodeType!==1){return false}var matchesSelector=ele.matches||ele.matchesSelector||ele.webkitMatchesSelector||ele.mozMatchesSelector||ele.msMatchesSelector||ele.oMatchesSelector;try{return matchesSelector.call(ele,selectorStr(selector))}catch(e){console.error(new Error("选择器语法可能有错误："+selector))}}function dir(element,key,selector){var rdom=[];$.loop(element,function(el){while(el=el[key]){if(!selector||isSelectDom(el,selector)){rdom.push(el)}}});return rdom}function selectorStr(selector){if(selector){selector=selector.trim();selector=selector.replace(/(:selected)/g,":checked")}return selector}function selectorAll(dom,selector){selector=selectorStr(selector);if(selector.substr(0,1)==">"){selector=":scope "+selector}var ele=dom.querySelectorAll(selector);if(!ele.length&&selector.indexOf("[")===-1){ele=dom.querySelectorAll('[ks-selector="'+selector+'"]')}return ele}function $(selector){var dt=new K_S_A(selector);dt.__proto__=K;return dt}function K_S_A(selector){if(selector){if(selector instanceof $){return selector}else if($.isWindow(selector)||$.isDomAll(selector)){selector=[selector]}else if($.isString(selector)){selector=selectorStr(selector);if(selector.indexOf("<")===0&&selector.length>=3){selector=createDom(selector,true)}else{selector=[].slice.call(selectorAll(document,selector))}}else if($.isFunction(selector)){$.ready(selector);return}var length=selector.length;var obj={};$.loop(selector,function(ele,key){obj[key]=ele});selector=obj;selector.length=length}else{selector={length:0}}if(selector.length){$.arrayMerge(this,selector);this.length=selector.length}return this}K_S_A.prototype=$.prototype=K={};var DocumentReadyFunction=[];K.ready=function(callback){this.map(function(ele){if(ele===document||ele===window){DocumentReadyFunction.push(function(){callback.call(ele)})}else{ele.addEventListener("DOMContentLoaded",function(){callback.call(ele)},false)}});return this};K.DOMchange=function(action,Callback){this.map(function(ele){var isBindEvent=ele.KSADOMchangeEvent?true:false;if(!ele.KSADOMchangeEvent){ele.KSADOMchangeEvent={}}$.loop($.explode(" ",action,""),function(ac){ac=ac.toLowerCase();if(!ele.KSADOMchangeEvent[ac]){ele.KSADOMchangeEvent[ac]=[]}ele.KSADOMchangeEvent[ac].push(Callback)});if(isBindEvent){return}$(ele).on("KSADOMchange",function(e){var ths=this,Arg=e.KSAcallbackArgs;Arg[0]=Arg[0].toLowerCase();if(!this.KSADOMchangeEvent||!this.KSADOMchangeEvent[Arg[0]]){return}$.loop(this.KSADOMchangeEvent[Arg[0]],function(fun){fun.apply(ths,[Arg[1],Arg[2]])})})});return this};K.clone=function(withs,deepWith){var newObj=$();this.each(function(index,ele){var eleID=$.objectID(ele);var events=bindEventData[eleID];var newEle=ele.cloneNode(withs);$.objectID(newEle,"");if(deepWith&&events){var $newEle=$(newEle);$.loop(events,function(evn,evnName){$.loop(evn,function(ev){$newEle.on(evnName,ev.selector,ev.callback)})})}newObj.push(newEle)});return newObj};$.dom=function(code){var dom=createDom(code);return dom.length===1?dom[0]:dom};function eleUpdateClass(ele,inClass,isDel,ms){if(!inClass){return}function _clsrun(){var className=ele.getAttribute("class")||"";var newClass={};$.loop($.explode(" ",className+" "+inClass,""),function(val){val=val.trim();if(val){newClass[val]=1}});if(isDel){inClass=$.explode(" ",inClass,"");$.loop(newClass,function(val,key){if($.inArray(key,inClass)){delete newClass[key]}})}newClass=$.implode(" ",Object.keys(newClass));if(newClass&&newClass!=className){ele.className=newClass}else if(!newClass){ele.removeAttribute("class")}}if(ms>0){window.setTimeout(_clsrun,ms)}else{_clsrun()}}K.addClass=function(name,ms){if(name){var msArr=ms&&$.isArray(ms)?ms:null;this.each(function(index,ele){var inms=msArr?msArr[index]:ms;eleUpdateClass(ele,name,false,inms)})}return this};K.removeClass=function(name,ms){if(name){var msArr=ms&&$.isArray(ms)?ms:null;this.each(function(index,ele){var inms=msArr?msArr[index]:ms;eleUpdateClass(ele,name,true,inms)})}return this};K.hasClass=function(cls){var ele,i=0;while(ele=this[i++]){if(ele.nodeType===1){var cl=ele.getAttribute("class");if(cl&&cl.length&&$.inArray(cls,$.explode(" ",cl,""))){return true}}}return false};K.prop=function(key,value){key=$.explode(" ",key,"");if($.isset(value)){value=value===""?null:value;this.map(function(ele){$.loop(key,function(k){if(value===null){delete ele[k]}else if($.isset(value)){var old=ele[k];if(old!==value){ele[k]=value;$(ele).trigger("KSADOMchange",["attr."+k,value,old])}}})});return this}else{var ele=this[0];if(!ele){return}var dt={};$.loop(key,function(k){dt[key]=ele[key]});if(key.length===1){return dt[key[0]]}else{return dt}}};var ElementAttrBooleanArr=["active","checked","selected","async","autofocus","autoplay","controls","defer","disabled","hidden","ismap","loop","multiple","open","readonly","required","scoped"];$.attrs=function(ele){if(!ele||!ele.attributes){return}var attrs={};$.loop(ele.attributes,function(val){var v=val.value;if($.inArray(val.name,ElementAttrBooleanArr)){v=$.inArray(val.name,["checked","selected"])?ele[val.name]:v;v=v===""?true:!!v}attrs[val.name]=v});return attrs};function EleAttrPropUped(key,value,isCustom){var isValue=$.isset(value);value=!!value;if(!isValue){var ele=this[0];if(!ele){return}if(ele.tagName==="INPUT"&&$.inArray(key,["checked"])){return ele[key]}var val=ele.getAttribute(key);if($.isNull(val)){val=ele[key]}val=val===""?true:val;return $.inArray(val,["false","undefined","null"])?false:!!val}else if($.isset(value)){this.map(function(ele){var old=ele[key];if(old===value){return}if(value){ele[key]=value;ele.setAttribute(key,key)}else{if(isCustom){delete ele[key]}else{ele[key]=false}ele.removeAttribute(key)}$(ele).trigger("KSADOMchange",["attr."+key,value,old])});return this}}K.checked=function(value){return EleAttrPropUped.call(this,"checked",value)};K.selected=function(value){return EleAttrPropUped.call(this,"selected",value)};K.disabled=function(value){return EleAttrPropUped.call(this,"disabled",value)};K.active=function(value){return EleAttrPropUped.call(this,"active",value,1)};K.attr=function(key,value){value=value===""?null:value;var valueIsNull=value===null;var isKey=$.isset(key);var keyIsobj=$.isObject(key);var isvalue=$.isset(value);var md="";if(keyIsobj||isKey&&isvalue&&!valueIsNull){md="set"}else if(isKey&&valueIsNull){md="del"}else if((!isKey||!keyIsobj)&&!isvalue){md="get"}if(!keyIsobj){key=$.explode(" ",key,"")}var dataAttr={};if(md=="get"){var ele=this[0];if(!ele){return}var attrs={};if(!isvalue&&!isKey){attrs=$.attrs(ele)}else{$.loop(key,function(k){var attrV=ele.getAttribute(k);if(!$.isNull(attrV)){attrs[k]=attrV}})}if(key.length===1){return attrs[key[0]]}else{return attrs}}else if(md=="set"){var sets;if(keyIsobj){sets=key}else{sets={};$.loop(key,function(k){sets[k]=value})}if(sets){this.map(function(ele){var oldAttrs=$.attrs(ele);var isUpdate;$.loop(sets,function(val,k){var odV=oldAttrs[k]===""?true:oldAttrs[k];if(!odV||val!==odV){val===""||$.isNull(val)?ele.removeAttribute(k):ele.setAttribute(k,val===true?"":val);$(ele).trigger("KSADOMchange",["attr."+k,val,odV]);if(k.indexOf("data-")===0){dataAttr[k.substr(5)]=val}isUpdate=1}});isUpdate&&$(ele).trigger("KSADOMchange",["attr"])})}if(!$.isEmpty(dataAttr)){this.data(dataAttr)}return this}else if(md=="del"){this.map(function(ele){var attrs=$.attrs(ele);$.loop(key,function(k){if(k.indexOf("data-")===0){dataAttr[k.substr(5)]=null}ele.removeAttribute(k);$.isset(attrs[k])&&$(ele).trigger("KSADOMchange",["attr."+k])})});if(!$.isEmpty(dataAttr)){this.data(dataAttr)}return this}};K.removeAttr=function(key){if(key){this.attr(key,null)}return this};K.data=function(key,value){value=value===""?null:value;var valueIsNull=value===null;var isKey=$.isset(key);var keyIsobj=$.isObject(key);var isvalue=$.isset(value);var md="";if(keyIsobj||isKey&&isvalue&&!valueIsNull){md="set"}else if(isKey&&valueIsNull){md="del"}else if((!isKey||!keyIsobj)&&!isvalue){md="get"}key=key&&!keyIsobj?$.explode(" ",key,""):key;if(md=="set"){this.map(function(ele){if(!ele._KSAOS_COM_ELE_DATA){ele._KSAOS_COM_ELE_DATA={}}var _Attrs=ele._KSAOS_COM_ELE_DATA;var setData={};if(keyIsobj){setData=key}else{$.loop(key,function(k){setData[k]=value})}$.loop(setData,function(v,k){v=v===""?null:v;var sk="data-"+k;if(!$.isObject(v)){if($.isNull(v)){ele.removeAttribute(sk);$.isset(_Attrs[k])&&delete _Attrs[k];$(ele).trigger("KSADOMchange",["data."+k])}else if(_Attrs[k]!==v){ele.setAttribute(sk,v);$(ele).trigger("KSADOMchange",["data."+k,v,_Attrs[k]]);_Attrs[k]=v}}else{_Attrs[k]=v}})});return this}else if(md=="get"){var ele=this[0];if(!ele){return}if(!ele._KSAOS_COM_ELE_DATA){ele._KSAOS_COM_ELE_DATA={}}if(key){var getdt={};$.loop(key,function(k){var v=ele._KSAOS_COM_ELE_DATA[k];if(!$.isset(v)){v=ele.getAttribute("data-"+k)}if(!$.isNull(v)){getdt[k]=v}});if(key.length===1){return getdt[key[0]]}else{return getdt}}else{var getdt=ele._KSAOS_COM_ELE_DATA||{};$.loop(this.attr(),function(val,k){if(k.indexOf("data-")===0){getdt[k.substr(5)]=val}});if(!$.isEmpty(getdt)){return getdt}}}else if(md==="del"){this.map(function(ele){var _Attrs=ele._KSAOS_COM_ELE_DATA;if(_Attrs){$.loop(key,function(k){if($.isset(_Attrs[k])){$(ele).trigger("KSADOMchange",["data."+k,undefined,_Attrs[k]]);ele.removeAttribute("data-"+k);delete _Attrs[k]}})}});return this}};K.removeData=function(key){if(key){this.data(key,null)}return this};K.empty=function(){this.map(function(ele){var h=ele.innerHTML;ele.innerHTML="";$(ele).trigger("KSADOMchange",["html","",h])});return this};K.val=function(value){if($.isset(value)&&value!==null){this.map(function(ele,index){if($.inArray(ele.tagName,["INPUT","SELECT","TEXTAREA"])){if($.isFunction(value)){var oldvalue=ele.value;if(ele.tagName=="SELECT"&&ele.multiple){oldvalue=[];$.loop(ele.options,function(e){e.selected&&oldvalue.push(e.value)})}value=value.call(ele,index,oldvalue)}switch(ele.tagName){case"INPUT":var tp=ele.getAttribute("type");tp=tp.indexOf("ks-")===0?tp.substr(3):tp;if(tp==="checkbox"){var val=$(ele).attr("value");if($.isset(val)){$(ele).checked($.isArray(value)?$.inArray(val,value):val==value)}else{$(ele).checked($.isObject(value)?$.isEmpty(value):!!value)}}else if(tp==="radio"){$(ele).checked($(ele).attr("value")==value)}else{ele.value=value}break;case"SELECT":value=$.isArray(value)?value:[value];if(ele.options){$.loop(ele.options,function(e){var r=$.inArray(e.value,value);if(r!=e.selected){e.selected=r}})}$(ele).trigger("ksachange");break;case"TEXTAREA":ele.value=value;break;default:}$(ele).trigger("KSADOMchange",["val",value])}});return this}else{var t=[];var ele=this[0];if(!ele||ele.disabled){return}var tg=ele.tagName;switch(tg){case"INPUT":var tp=ele.getAttribute("type");tp=tp.indexOf("ks-")===0?tp.substr(3):tp;if($.inArray(tp,["checkbox","radio"])){ele.checked&&t.push(ele.value)}else{t.push(ele.value)}break;case"SELECT":$(ele).find("option:selected").map(function(e){t.push(e.value)});break;case"TEXTAREA":t.push(ele.value);break;default:}if(t.length===1){return t[0]}else{return t}}};K.text=function(value){if($.isset(value)){this.map(function(ele,index){if(ele.nodeType===1||ele.nodeType===11||ele.nodeType===9){var oldtxt=ele.textContent;if(oldtxt!=value){ele.textContent=$.isFunction(value)?value.call(ele,index,oldtxt):value;$(ele).trigger("KSADOMchange",["html",value,oldtxt])}}else if(ele.nodeType===3){var oldtxt=ele.textContent;ele.textContent=$.isFunction(value)?value.call(ele,index,oldtxt):value;$(ele).trigger("KSADOMchange",["html",value,oldtxt])}});return this}else{var t=[];this.map(function(ele){t.push(ele.textContent||"")});return t.join("\n")}};K.contents=function(){var newObj=$();this.map(function(ele){$.loop(ele.childNodes,function(e){newObj.push(e)})});return newObj};K.html=function(value){if($.isset(value)){this.map(function(ele,index){$(ele).empty().append($.isFunction(value)?value.call(ele,index,ele.innerHTML):value);$(ele).trigger("KSADOMchange",["html",value])});return this}else{var t=[];this.map(function(ele){t.push(ele.innerHTML||ele.textContent)});return t.join("")}};K.outerHtml=function(){var t=[];this.map(function(ele){t.push(ele.outerHTML||ele.textContent)});return t.join("")};K.formData=function(isFormData){var formData={};var ele=this[0];if(isFormData){formData=new FormData(ele)}else{$(ele).find("input, textarea, select").each(function(i,el){el=$(el);var name=el.attr("name");var val=el.val();var type=el.attr("type");if(name){if(type==="file"){formData[name]=el[0].files.length?el[0].files[0]:""}else if($.inArray(type,["radio","checkbox"])){if(el.checked()){formData[name]=val}}else{if($.isArray(val)){formData[name]=[];$.loop(val,function(v){formData[name].push(v)})}else{formData[name]=val}}}})}return formData};K.serialize=function(){var dt=this.formData();return $.urlGetString(dt,true)};K.remove=function(){this.map(function(ele){if(ele.parentNode){ele.parentNode.removeChild(ele);$(ele).trigger("KSADOMchange",["remove"]);$(ele.parentNode).trigger("KSADOMchange",["html"])}});return this};K.after=function(html){return tempDom.call(this,html,function(ele,node){if(ele.parentNode){ele.parentNode.insertBefore(node,ele.nextSibling);$(ele).trigger("KSADOMchange",["after",html]);$(ele.parentNode).trigger("KSADOMchange",["html"])}},true)};K.before=function(html){return tempDom.call(this,html,function(ele,node){if(ele.parentNode){ele.parentNode.insertBefore(node,ele);$(ele).trigger("KSADOMchange",["before",html])}})};K.append=function(html){return tempDom.call(this,html,function(ele,node){if(!node){return}ele.appendChild(node);$(ele).trigger("KSADOMchange",["append",html])})};K.prepend=function(html){return tempDom.call(this,html,function(ele,node){ele.insertBefore(node,ele.firstChild);$(ele).trigger("KSADOMchange",["prepend",html])},true)};K.wrap=function(html){this.map(function(e,index){var dom=$.dom($.isFunction(html)?html.call(e,index):html);$(e).after(dom);$(dom).html(e)});return this};K.wrapAll=function(html){var dom=$($.isFunction(html)?html.call(e,index):html);$(this[0]).before(dom);dom.html(this);return this};K.wrapInner=function(html){this.map(function(e){e=$(e);var dom=$($.isFunction(html)?html.call(e,index):html);dom.html(e.contents());e.html(dom)});return this};K.height=function(val,isMargin){if(!$.isset(val)||val===true){var dom=this[0];if(!dom){return}if(dom===window||dom===document){return document.documentElement.clientHeight||document.body.clientHeight}else{var size=dom.offsetHeight;var css=$.intval(this.css("paddingBottom paddingTop borderBottomWidth borderTopWidth marginBottom marginTop"));if(val!==true){size-=css.paddingBottom+css.paddingTop+css.borderBottomWidth+css.borderTopWidth}if(isMargin===true){size+=css.marginBottom+css.marginTop}return size}}else{this.css("height",$.isNumber(val)?val+"px":val);return this}};K.width=function(val,isMargin){if(!$.isset(val)||val===true){var dom=this[0];if(dom===window||dom===document){return document.documentElement.clientWidth||document.body.clientWidth}else{var size=dom.offsetWidth;var css=$.intval(this.css("paddingLeft paddingRight borderLeftWidth borderRightWidth marginLeft marginRight"));if(val!==true){size-=css.paddingLeft+css.paddingRight+css.borderLeftWidth+css.borderRightWidth}if(isMargin===true){size+=css.marginLeft+css.marginRight}return size}}else{this.css("width",$.isNumber(val)?val+"px":val);return this}};K.offset=function(){var ele=this[0];if(!ele){return}if(!ele.getClientRects().length){return{top:0,left:0}}var rect=ele.getBoundingClientRect();var win=ele.ownerDocument.defaultView;return{top:rect.top+win.pageYOffset,left:rect.left+win.pageXOffset}};K.show=function(){this.map(function(e){e.style.display="";e.style.display=e.style.display==="none"?"block":"";$(e).trigger("KSADOMchange",["show"])});return this};K.hide=function(){this.map(function(e){e.style.display="none";$(e).trigger("KSADOMchange",["hide"])});return this};$.AnimationFrame=function(numbers,Atimes,callFunc){if(!$.AnimationFrameCache){$.AnimationFrameCache={_index:0}}if(!numbers){return}Atimes=parseInt(Atimes||0)||2e3;var id=$.AnimationFrameCache._index++;var start;var aObj=$.AnimationFrameCache[id]={};var _Atime=0;var _Aindex=0;var numbersIsArr=$.isArray(numbers);function _stepVal(val,time){time=parseFloat(time).toFixed(0);var rate=Math.min((time/Atimes).toFixed(2),1);return parseInt(val*rate)}var lastTime;function _thisRun(timestamp){if(!aObj.start){aObj.start=timestamp}start=aObj.start;var progress=timestamp-start;if(!_Atime){_Atime=timestamp-lastTime}var callResult;if(_Atime>0&&progress<=Atimes){_Aindex++;if(numbersIsArr){var callNumber=[];$.loop(numbersIsArr,function(value){callNumber.push(_stepVal(value,progress))})}else{callNumber=_stepVal(numbers,progress)}callResult=callFunc.call("",callNumber,_Aindex,_Atime)}if(callResult===false||progress>=Atimes){window.cancelAnimationFrame(aObj.AnimationID);delete $.AnimationFrameCache[id]}else{window.cancelAnimationFrame(aObj.AnimationID);aObj.AnimationID=window.requestAnimationFrame(_thisRun)}lastTime=timestamp}aObj.AnimationID=window.requestAnimationFrame(_thisRun);return aObj};K.scrollTop=function(val,AnimationTime){if(!$.isset(val)){var dom=this[0];if(dom===document){dom=dom.scrollingElement}return dom?dom.scrollTop:0}else{this.map(function(e){var top=e.scrollTop;var distance=val-top;if(AnimationTime&&distance>=-5&&distance<=5){AnimationTime=false}if(AnimationTime){AnimationTime=AnimationTime===true?500:AnimationTime;$.AnimationFrame(distance,AnimationTime,function(callVal){if(Math.abs(callVal)>Math.abs(distance)){return false}e.scrollTop=top+callVal})}else{e.scrollTop=top+distance}});return this}};K.reachBottom=function(callFun,Nus){Nus=Nus?Nus:50;this.map(function(ele){var isDom=ele===document;var isCall;var S;$(ele).scroll(function(){var ths=$(this);var scrollTop=ths.scrollTop();var viewH=ths.height(true);var contentH=isDom?$("html")[0].scrollHeight:this.scrollHeight;var scY=Math.abs(scrollTop-(contentH-viewH));if(!isCall&&scY<Nus){callFun.call(ele,ele);isCall=true}else if(scY>Nus){S&&window.clearTimeout(S);S=window.setTimeout(function(){isCall=false},300)}})})};K.scrollLeft=function(val,AnimationTime){if(!$.isset(val)){return this[0]?this[0].scrollLeft:0}else{this.map(function(e){e.scrollLeft=parseFloat(val);var left=e.scrollLeft;var distance=val-left;if(AnimationTime&&distance>=-5&&distance<=5){AnimationTime=false}if(AnimationTime){AnimationTime=AnimationTime===true?500:AnimationTime;$.AnimationFrame(distance,AnimationTime,function(callVal){if(Math.abs(callVal)>Math.abs(distance)){return false}e.scrollLeft=left+callVal})}else{e.scrollLeft=left+distance}});return this}};K.css=function(key,value){var cssNumber=["animationIterationCount","columnCount","fillOpacity","flexGrow","flexShrink","fontWeight","gridArea","gridColumn","gridColumnEnd","gridColumnStart","gridRow","gridRowEnd","gridRowStart","lineHeight","opacity","order","orphans","widows","zIndex","zoom"];value=value===""?null:value;var sets,gets={},keyIsObj=$.isObject(key),isValue=$.isset(value);if(key){if(!isValue&&keyIsObj){sets=key}else if(isValue){sets={};sets[key]=value}var style=[];$.loop(sets,function(value,key){key=key.replace(/-([a-z]{1})/g,function(_1,_2){return _2.toUpperCase()+""});var soukey=key.replace(/^(-moz-|-ms-|-webkit-|-o-|\+|_|\*)/gi,"");if(!$.inArray(soukey,cssNumber)&&$.isNumber(value)){value=value+"px"}sets[key]=value;style.push(key+":"+value)});style=style.length?$.implode("; ",style):"";if(sets){this.map(function(e){var isEdit;$.loop(sets,function(v,k){if(e.style[k]!=v){var oldv=e.style[k];e.style[k]=v;$(e).trigger("KSADOMchange",["css."+k,v,oldv]);isEdit=1}});isEdit&&$(e).trigger("KSADOMchange",["css"])});return this}else{if(this[0]){var getkeys=$.explode(" ",key,"");var sty=window.getComputedStyle(this[0],null);$.loop(getkeys,function(val){gets[val]=sty[val]});if(getkeys.length===1){return gets[getkeys[0]]}else{return gets}}}}};$.loop=function(dt,fun,actions){if(!dt){return}if(dt instanceof $||$.isArrayLike(dt)){var length=dt.length;if(!length){return}for(i=0;i<dt.length;i++){var val=dt[i];if(actions&&(actions==="first"||actions==="last"&&i===length-1)||fun(val,i,i)===true){return val}}}else if($.isNumber(dt)){for(i=1;i<=dt;i++){if(actions&&(actions==="first"||actions==="last"&&i===dt-1)||fun(i,i-1,i-1)===true){return i}}}else if($.isObject(dt)){var keys=Object.keys(dt),i=0,len=keys.length,key,val;if(len){for(key in keys){var k=keys[key];val=dt[k];if(actions&&(actions==="first"||actions==="last"&&i===len-1)||fun(val,k,i)===true){return val}i++}}}};K.each=function(callback){$.loop(this,function(ele,index){callback&&callback.call(ele,index,ele)});return this};$.map=K.map=function(elements,callback){var isThis=false;if(!callback&&$.isFunction(elements)){callback=elements;elements=this;isThis=true}var newArr=[],i=0;$.loop(elements,function(val,k){var r=callback.call(isThis?val:window,val,k,i);if(r!==null&&$.isset(r)){newArr.push(r)}i++});if(isThis){newArr=$(newArr)}return newArr};$.slice=K.slice=function(){var arr=$();$.loop([].slice.apply(this,arguments),function(e){arr.push(e)});return arr};K.push=function(ele){var ths=this;var length=ths.length?ths.length:0;if(ele instanceof $){ele.each(function(_,e){ths[length]=e;length++})}else if($.isArray(ele)){$.loop(ele,function(e){ths[length]=e;length++})}else{ths[length]=ele;length++}if(length){ths.length=length}return ths};K.eq=function(n){var isArr=$.isArray(n);var obj=$();this.map(function(e,i){if(isArr&&$.inArray(i,n)||!isArr&&i==n){obj.push(e)}});return obj};K.index=function(){var ele=this[0];var index=-1;if(ele){$(ele).parent().children().each(function(i,e){if(e==ele){index=i}})}return index};K.first=function(){return $(this[0])};K.last=function(){var n=this.length>1?this.length-1:0;return $(this[n])};K.is=function(selector){var s=false;this.map(function(ele){if(isSelectDom(ele,selector)){s=true}});return s};K.find=function(selector){selector=selector||"*";var rdom=$();this.map(function(ele){$.loop(selectorAll(ele,selector),function(el){rdom.push(el)})});return rdom};K.filter=function(selector){selector=selector||"*";return this.map(function(ele){if(isSelectDom(ele,selector)){return ele}})};K.children=function(selector){selector=selector||"*";var rdom=$(),ri=0;this.map(function(ele){$.loop(ele.childNodes,function(el){if(isSelectDom(el,selector)){rdom[ri]=el;ri++}})});rdom.length=ri;return rdom};K.childAll=function(){var rdom=$(),ri=0;this.map(function(ele){$.loop(ele.childNodes,function(el){rdom[ri]=el;ri++})});rdom.length=ri;return rdom};K.siblings=function(selector){selector=selector||"*";var rdom=$(),ri=0;this.map(function(ele){$.loop(ele.parentNode.childNodes,function(el){if(el!=ele&&isSelectDom(el,selector)){rdom[ri]=el;ri++}})});rdom.length=ri;return rdom};K.parent=function(selector){selector=selector||"*";var rdom=$(),ri=0;this.map(function(ele){var el=ele.parentNode;if(el!=ele&&isSelectDom(el,selector)){rdom[ri]=el;ri++}});rdom.length=ri;return rdom};K.parents=function(selector){var rdom=$(),ri=0;$.loop(dir(this,"parentNode",selector),function(el){rdom[ri]=el;ri++});rdom.length=ri;return rdom};K.prev=function(selector){selector=selector||"*";var rdom=$(),ri=0;this.map(function(ele,i){if(isSelectDom(ele.previousElementSibling,selector)){rdom[ri]=ele.previousElementSibling;ri++}});rdom.length=ri;return rdom};K.prevAll=function(selector,isAll){var rdom=$(),ri=0;$.loop(dir(this,isAll?"previousSibling":"previousElementSibling",selector),function(el){rdom[ri]=el;ri++});rdom.length=ri;return rdom};K.next=function(selector){selector=selector||"*";var rdom=$(),ri=0;this.map(function(ele){if(isSelectDom(ele.nextElementSibling,selector)){rdom[ri]=ele.nextElementSibling;ri++}});rdom.length=ri;return rdom};K.nextAll=function(selector,isAll){var rdom=$(),ri=0;this.map(dir(this,isAll?"nextSibling":"nextElementSibling",selector),function(ele){rdom[ri]=ele;ri++},isAll);rdom.length=ri;return rdom};function eventParse(event){event=(""+event).split(".");return{evn:event[0],scope:event[1]||""}}K.on=function(event,selector,callback){if($.isFunction(selector)&&!callback){callback=selector;selector=null}callback=callback?callback:function(){return false};event=event.split(/\s/);return this.each(function(_,ele){var kid=$.objectID(ele);bindEventData[kid]=bindEventData[kid]||{};$.loop(event,function(evn){if(evn=="ready"){return $(document).ready(callback)}var useCapture=false;var handler=eventParse(evn);handler.fun=callback;handler.selector=selector;handler.call=function(e){eventAddstopPropagation(e);if(e.isStop||e.target.nodeName==="KS-BTN"&&$(e.target).disabled()){return false}var args=arguments;if(selector){var els=selectorAll(ele,selector);$.loop(e.path,function(val){if($.inArray(val,els)){if(callback.apply(val,args)===false){e.stop()}}})}else{if(callback.apply(ele,args)===false){e.stop()}}};bindEventData[kid][evn]=bindEventData[kid][evn]||[];bindEventData[kid][evn].push({callback:callback,selector:selector,useCapture:useCapture,handler:handler});var realEvn=evn.replace(/\..*/,"");ele.addEventListener(realEvn,handler.call,useCapture)})})};K.off=function(event,callback){var isCall=callback?1:0;callback=callback?callback:function(){return false};event=$.explode(" ",event,"");this.map(function(ele){var kid=$.objectID(ele);$.loop(event,function(evn){var evnDt=bindEventData[kid]&&bindEventData[kid][evn]?bindEventData[kid][evn]:null;evn=evn.replace(/\..*/,"");if(evnDt){var delN=0;$.loop(evnDt,function(val,i){if(val&&(!isCall||val.callback===callback)){ele.removeEventListener(evn,val.handler.call,val.useCapture);evnDt[i]=null;delN++}});if(evnDt.length===delN){delete bindEventData[kid][evn]}}else{ele.removeEventListener(evn,callback,false);ele.removeEventListener(evn,callback,true)}});$.isset(bindEventData[kid])&&$.isEmpty(bindEventData[kid])&&delete bindEventData[kid]});return this};K.hover=function(a,b){return this.mouseenter(a).mouseleave(b||a)};K.select=function(func){if($.isset(func)){if(!$.isFunction(func)){return}this.on("select",function(evn){var txt=window.getSelection?window.getSelection().toString():document.selection.createRange().text;func.call(this,evn,txt)})}else{this.map(function(ele){if($.isFunction(ele.select)){ele.select()}})}};K.touchlong=function(fun,moveFun,endFun){var S,x=0,y=0;var lastX=0,lastY=0;this.on("touchstart touchmove touchend mousedown mouseup mouseout mouseleave",function(e){if($.inArray(e.type,["touchstart","mousedown"])){if(e.type=="touchstart"){x=(e.targetTouches?e.targetTouches[0].pageX:e.pageX)||0;y=(e.targetTouches?e.targetTouches[0].pageY:e.pageY)||0}e.stop();S=setTimeout(function(){e.ksaX=x;e.ksaY=y;fun.call(e.target,e);$(document).on("touchmove.touchlong mouseleave.touchlong",function(me){lastX=(me.targetTouches?me.targetTouches[0].pageX:me.pageX)||0;lastY=(me.targetTouches?me.targetTouches[0].pageY:me.pageY)||0;me.ksaX=lastX;me.ksaY=lastY;moveFun&&moveFun.call(e.target,me)});$(document).on("touchend.touchlong mouseup.touchlong",function(de){var _dom=document.elementFromPoint(lastX,lastY);de.ksaX=lastX;de.ksaY=lastY;endFun&&endFun.call(e.target,de);$(document).off("touchmove.touchlong mouseleave.touchlong touchend.touchlong mouseup.touchlong")})},400)}else if($.inArray(e.type,["touchmove","mouseleave"])){var x1=(e.changedTouches?e.changedTouches[0].pageX:e.pageX)||0;var y1=(e.changedTouches?e.changedTouches[0].pageY:e.pageY)||0;if(Math.abs(x1-x)>25||Math.abs(y1-y)>25){clearTimeout(S)}}else{clearTimeout(S)}});return this};K.touch=function(startFun,moveFun,endFun,path){var X=0,Y=0,action,isRun,moveTime;var touchNames="ontouchstart"in document.documentElement?"touchstart touchmove touchend":"mousedown mousemove mouseup";var startEvent;this.on(touchNames,function(e){startEvent=e;var ex=0,ey=0,cx=0,cy=0;if($.inArray(e.type,["touchstart","mousedown"])){X=ex=(e.targetTouches?e.targetTouches[0].pageX:e.pageX)||0;Y=ey=(e.targetTouches?e.targetTouches[0].pageY:e.pageY)||0;startFun&&startFun.call("",e,{currentX:ex,currentY:ey,startX:X,startY:Y});isRun=true;moveTime=e.timeStamp}else if(isRun&&$.inArray(e.type,["touchmove","mousemove"])){ex=(e.targetTouches?e.targetTouches[0].pageX:e.pageX)||0;ey=(e.targetTouches?e.targetTouches[0].pageY:e.pageY)||0;cx=ex-X;cy=ey-Y;if(!action&&(Math.abs(cx)>8||Math.abs(cy)>8)){var ages=$.rightTriangleAge(cx,cy);if(ages.scale<15){action=cx>0?"right":"left"}else{action=cy>0?"down":"up"}}if(action){moveFun&&moveFun.call("",e,{action:action,moveX:cx,moveY:cy,currentX:ex,currentY:ey,startX:X,startY:Y})}if(!path||path==="X"&&$.inArray(action,["left","right"])||path==="Y"&&$.inArray(action,["up","down"])){return false}}else if(isRun){ex=(e.changedTouches?e.changedTouches[0].pageX:e.pageX)||0;ey=(e.changedTouches?e.changedTouches[0].pageY:e.pageY)||0;cx=ex-X;cy=ey-Y;var mTime=e.timeStamp-moveTime;var isX=$.inArray(action,["left","right"]),isY=$.inArray(action,["up","down"]);var scaleX=Math.abs(cx)/$(this).width(true)*100,scaleY=Math.abs(cy)/$(this).height(true)*100;if(mTime>=800&&(isX&&scaleX<50||isY&&scaleY<50)){action=""}if(!path||path==="X"&&isX||path==="Y"&&isY){endFun&&endFun.call("",e,{action:action,moveX:cx,moveY:cy,currentX:ex,currentY:ey,startX:X,startY:Y,scaleX:scaleX,scaleY:scaleY})}X=0;Y=0;action=null;isRun=null}});return this};$.Event=function(name){var events;try{events=new Event(name,{bubbles:true,cancelable:true})}catch(e){events=document.createEvent("Events");events.initEvent(name,true,true)}eventAddstopPropagation(events);return events};K.addEvent=function(name,func,useCapture,isRun,runDel){this.map(function(ele){var eEvn=$.Event(name);ele.addEventListener(name,func,useCapture);if(isRun){ele.dispatchEvent(eEvn)}if(runDel){$(ele).removeEvent(name,func,useCapture)}});return this};K.removeEvent=function(name,func,useCapture){this.map(function(ele){ele.removeEventListener(name,func,useCapture)})};K.trigger=function(event,args){this.map(function(ele){if($.isFunction(ele[event.type])){ele[event.type]()}else{var e=$.Event(event);e.KSAcallbackArgs=args;ele.dispatchEvent(e)}});return this};K.submit=function(callFun){if(callFun){return this.on("submit",callFun)}else{return this.trigger("submit")}};$.rightTriangleAge=function(a,b){a=Math.abs(a);b=Math.abs(b);var c=Math.sqrt(a*a+b*b);var bc=Math.acos((a*a+c*c-b*b)/(2*a*c));bc=parseInt(bc/Math.PI*180*1e4)/1e4;var ac=90-bc;return{scale:bc,a:a,b:b,c:c,age:{ab:90,ac:ac,bc:bc}}};$.url=function(url,param){var u=[];if(url){u=url.match(/^((\w+:)?\/\/)?(.+\.\w+)?(:\d+)?([^?#]+)([^#]*)(#.*)?$/i)}var P={url:url?url:location.href,origin:url?u[1]||"":location.origin,https:url?u[2]&&u[2]==="https"?true:false:location.protocol,host:url?u[3]||"":location.hostname,port:url?u[4]?u[4].substr(1):"":location.port,pathname:url?u[5]||"":location.pathname,search:url?u[6]||"":location.search,paths:[],get:{},hash:url?u[7]?u[7]:"":location.hash};P.get=$.urlGetObject(P.search);var isParam=false;if(param&&!$.isEmpty(param)){param=$.isString(param)?$.urlGetObject(param):param;isParam=true}if(isParam){P.get=$.arrayMerge(P.get,param);P.search=!$.isEmpty(P.get)?"?"+$.urlGetString(P.get):""}if(P.pathname){var pn=P.pathname;$.loop(pn.split("/"),function(val,k){if(val!==""){P.paths.push(val)}})}if(isParam){P.url=P.origin+P.host+(P.port?":"+P.port:"")+P.pathname+P.search+P.hash}return P};$.urlAdd=function(url,query){return $.url(url,query).url};$.urlGetObject=function(url){var param={};if($.isString(url)){if(url.substr(0,1)=="?"){url=url.substr(1)}$.loop(url.split("&"),function(val){val=val.split("=");if(val["1"]){val["1"]=decodeURIComponent(val["1"]);param[val["0"]]=val["1"]}})}return param};$.urlGetString=function(url,isEncode){var str="";if($.isObject(url)){var u=[];$.loop(url,function(value,key){if(value===undefined){value=""}if(isEncode){value=encodeURIComponent(value)}key&&value&&u.push(key+"="+value)});str=$.implode("&",u)}return str};var jsonpID=1;$.ajax=function(option){var getType=option.type?option.type.toUpperCase():"GET",headers=option.header||{},dataType=option.dataType?option.dataType.toLowerCase():"html",jsonpCallback=option.jsonpCallback||"",jsonp=option.jsonp,responseData;option.data=option.data?option.data:{};option.data.KAJAX=true;if(dataType=="jsonp"){var copyCallback=$.isFunction(jsonpCallback)?"jsonpCallback"+jsonpID++:jsonpCallback;window[copyCallback]=function(){responseData=arguments};option.data.jsonpCallback=copyCallback;var script=document.createElement("script");script.src=$.urlAdd(option.url,option.data);script.type="text/javascript";$(script).on("load",function(e){var result=responseData[0];$(this).remove();if(jsonpCallback==copyCallback){window[jsonpCallback]=window[jsonpCallback]}if(responseData&&$.isFunction(jsonpCallback)){jsonpCallback.call(this,result)}if(e.type=="error"){$.isFunction(option.error)&&option.error.call(this,result)}else{$.isFunction(option.success)&&option.success.call(this,result)}option.complete&&option.complete.call(this,result)});document.head.appendChild(script);copyCallback=responseData=null}else{if(getType=="POST"){if(!(option.data instanceof FormData)){var _data=new FormData;$.loop(option.data,function(val,key){if($.isObject(val)){$.loop(val,function(v,k){_data.append(key+"["+k+"]",v)})}else{_data.append(key,val)}});option.data=_data;_data=""}}else if(getType=="GET"){option.url=$.urlAdd(option.url,option.data)}var A=new XMLHttpRequest;A.open(getType,option.url,true);$.loop(headers,function(val,k){A.setRequestHeader(k,val)});A.send(option.data);A.onreadystatechange=function(){if(A.readyState===4){var result=A.responseText;if(A.status===200){if(dataType==="script"){(1,eval)(result)}else if(dataType==="xml"){result=A.responseXML}else if(dataType==="json"){result=/^\s*$/.test(result)?null:JSON.parse(result)}$.isFunction(option.success)&&option.success.call(this,result)}else{$.isFunction(option.error)&&option.error.call(this,result,A.status)}option.complete&&option.complete.call(this,result,A.status)}};var EvnTimeout;if(option.timeout>0){EvnTimeout=setTimeout(function(){A.onreadystatechange=function(){};A.abort();$.isFunction(option.error)&&option.error.call(this,result,A.status);option.complete&&option.complete.call(this,result,A.status)},option.timeout)}}};Array.prototype.push=function(){for(var i=0;i<arguments.length;i++){if(this._KSAmonitor_===true){$.def.set(this,this.length,arguments[i])}else{this[this.length]=arguments[i]}}return this.length};$.def={debug:0,Event:{},newQueue:function(inObj){return{isPush:false,set:[],get:[],delete:[],add:[],reset:[],monitor:{},object:inObj,clear:function(){this.set=[];this.get=[];this.add=[];this.delete=[];this.monitor={}},run:function(ac,newObj,keyName,newV){var ths=this;if(ths[ac]){$.loop(ths[ac],function(f){f.apply(ths,[newV,keyName,newObj])});ac==="reset"&&ths.clear()}if(ths.monitor&&ths.monitor[keyName]){$.loop(ths.monitor[keyName][ac],function(f){f.apply(ths,[newV,keyName,newObj])});ac==="reset"&&ths.monitor[keyName].clear()}if($.def.debug){debug({txt:"触发监听链",action:ac,obj:newObj,objID:$.objectID(newObj),keyName:keyName,value:newV})}}}},objMap:function(obj){var objID=$.objectID(obj);if(objID){if(!this.Event[objID]){this.Event[objID]=this.newQueue(obj)}return this.Event[objID]}},createEvent:function(action,obj,keyName,Fun){if(obj===window){return}var ths=this;if(!Fun&&$.isFunction(keyName)){Fun=keyName;keyName=undefined}if(!$.isObject(obj)||!$.isFunction(Fun)){return}var evnObj=ths.objMap(obj);$.loop($.explode(" ",action,""),function(ac){if($.isset(keyName)){$.loop($.explode(" ",keyName.toString(),""),function(key){if(!evnObj.monitor[key]){evnObj.monitor[key]=ths.newQueue(obj[key])}evnObj.monitor[key][ac].push(Fun);ths.monitor(obj,key,obj[key])})}else{evnObj[ac].push(Fun)}});ths.monitor(obj,keyName,obj[keyName])},objectIDSYN:function(obj,newObj){if($.isObject(obj)&&$.isObject(newObj)){var ths=this;var objID=$.objectID(obj);$.objectID(newObj,objID);var delObj=ths.deleteObjectIdList[objID];$.loop(newObj,function(val,key){var oldVal=obj[key];var newID;var valID=$.objectID(val);if($.isObject(oldVal)){newID=$.objectID(oldVal)}else if(delObj&&delObj[key]){newID=delObj[key];delete delObj[key]}if(newID&&newID!==valID){$.objectID(val,newID)}ths.objectIDSYN(obj[key],val)})}},diff:function(obj,keyName,value,oldValue){var map=this.objMap(obj);if(!map){return}map.run("set",obj,keyName,value,oldValue);var ths=this;if($.isObject(value)&&$.isObject(oldValue)){var newMap=ths.objMap(value);var isObjSet=0;$.loop(oldValue,function(v,k){if(!$.isset(value[k])||value[k]!==v){ths.delete(oldValue,k);isObjSet=1}});$.loop(value,function(v,k){if(!$.isset(oldValue[k])){newMap.run("add",value,k,v);isObjSet=1}ths.diff(value,k,v,oldValue[k])});if(isObjSet){var objMap=ths.objMap(obj);objMap&&objMap.run("set",obj,keyName,value)}}},monitor:function(obj,keyName,Value){if(!$.isObject(obj)||!$.isset(keyName)){return}var objID=$.objectID(obj);var ths=this;Value=obj[keyName];var oldObjectID=$.objectID(Value);var delObj=ths.deleteObjectIdList[objID];if(delObj&&delObj[keyName]){oldObjectID=delObj[keyName];delete delObj[keyName]}if(!$.isset(Value)){obj[keyName]=""}if($.isObject(Value)){$.loop(Value,function(v,k){ths.monitor(Value,k,v)})}var property=Object.getOwnPropertyDescriptor(obj,keyName);if(property&&property.configurable===false){return}if(property.set&&property.set.toString().indexOf("#KSAdefineProperty#")>0){return}try{var setter=property&&property.set;var getter=property&&property.get;if(!obj._KSAmonitor_){Object.defineProperty(obj.__proto__,"_KSAmonitor_",{value:function(){return true},enumerable:false,writable:false})}Object.defineProperty(obj,keyName,{enumerable:true,configurable:true,set:function(newV){"#KSAdefineProperty#";if(getter&&!setter){return}var oldValue=Value;setter&&setter.call(obj,newV);if(oldValue===newV){return}if(!$.isset(newV)){newV=""}Value=newV;newV.__ksaUpdate__&&newV.__ksaUpdate__();if($.isObject(newV)){ths.objectIDSYN(oldValue,newV);ths.debug&&debug({action:"对象劫持 set",obj:obj,key:keyName,value:newV,valueID:oldObjectID});$.loop(newV,function(v,k){ths.monitor(newV,k,v)})}ths.diff(obj,keyName,newV,oldValue)},get:function(v){var val=getter?getter.call(obj):Value;return val}})}catch(e){}},set:function(obj,keyName,dt){if(!obj){return}var ths=this,events=ths.objMap(obj);events&&events.run("add",obj,keyName,dt);if($.isObject(dt)){if(!$.isset(obj[keyName])){obj[keyName]=$.isArray(dt)?[]:{}}$.loop(dt,function(v,k){ths.set(obj[keyName],k,v)})}obj[keyName]=dt},deleteObjectIdList:{},delete:function(obj,keyName){if(!$.isObject(obj)||!$.isset(keyName)){return}var ths=this;var objID=$.objectID(obj);var objEvent=ths.objMap(obj);$.loop($.explode(" ",keyName.toString(),""),function(key){var delObj=obj[key];var delID=$.objectID(delObj);if(delID){if($.isObject(delObj)){ths.deleteObjectIdList[objID]=ths.deleteObjectIdList[objID]||{};ths.deleteObjectIdList[objID][key]=delID;ths.Event[delID]&&ths.Event[delID].run("delete",obj,key)}}objEvent&&objEvent.run("delete",obj,key);delete obj[key]});return obj}};$.getIncludeFunc=function(Args){var argsNames=Args.callee.toString().match(/^function(\s[^(]+)?\(([^)]+)?\){/);if(argsNames&&argsNames[2]){var dt={};argsNames=$.explode(",",argsNames[2],"");$.loop(argsNames,function(v,k){v=v.trim();dt[v]=Args[k]});return dt}};$.setTimeout=function(skey,func,time){if(!this.setTimeoutMap){this.setTimeoutMap={}}if(this.setTimeoutMap[skey]){window.clearTimeout(this.setTimeoutMap[skey]);delete this.setTimeoutMap[skey]}this.setTimeoutMap[skey]=window.setTimeout(func,time)};var autoIDMap={};$.autoID=function(key){if(!autoIDMap[key]){autoIDMap[key]=0}return autoIDMap[key]++};var _KSAobjectIDIndex=1;$.objectID=function(obj,newValue){var keyName="_uniqueID_";var isValue=$.isset(newValue);var isdel=newValue==="";if(obj instanceof HTMLElement){if(isdel){$.isset(obj[keyName])&&delete obj[keyName]}else if(isValue){obj[keyName]=newValue}else{if(!obj[keyName]){obj[keyName]=_KSAobjectIDIndex++}}return obj[keyName]}else if($.isWindow(obj)){return 0}else if($.isObject(obj)){if(isdel){$.isset(obj[keyName])&&delete obj[keyName]}else if(isValue){Object.defineProperty(obj,keyName,{value:newValue,enumerable:false,writable:true});return newValue}else{if(!$.isset(obj[keyName])){Object.defineProperty(obj,"_uniqueIDFunc_",{value:function(){if(!$.isset(this[keyName])){Object.defineProperty(this,keyName,{value:_KSAobjectIDIndex++,enumerable:false,writable:true})}return this[keyName]},enumerable:false,writable:false});obj._uniqueIDFunc_()}return obj[keyName]}}else if($.isFunction(obj)){if(isdel){$.isset(obj.prototype[keyName])&&delete obj.prototype[keyName]}else if(isValue){obj.prototype[keyName]=newValue}else{if(!obj.prototype[keyName]){obj.prototype[keyName]=_KSAobjectIDIndex++}return obj.prototype[keyName]}}};$.tpl=function(Config){if(!Config.tpl&&Config.el){Config.tpl=$(Config.el).html()}var variableReg=/{{((?:.|\r?\n)+?)}}/g;var extractReg=[/\s+([.()\[\]:?])[\s+]?/g,/\.(charAt|charCodeAt|concat|fromCharCode|indexOf|includes|lastIndexOf|match|repeat|replace|search|slice|split|startsWith|substr|substring|toLowerCase|toUpperCase|trim|toLocaleLowerCase|toLocaleUpperCase|valueOf|toString|anchor|big|blink|bold|fixed|fontcolor|fontsize|italics|link|small|strike|sub|sup)(\(.*?\))/g,/[()+\-*\/=%?|&><:!~\s]/];function torn(str){if(str){str=str.replace(/(\r\n|\r|\n)/g,function(_1){return _1==="\r\n"?"\\r\\n":_1==="\r"?"\\r":"\\n"})}return str}function strToQuotes(str){return'"'+str+'"'}var keyNameMap={};function keyName(kname,isOne){var kmapI=kname+"{"+isOne+"}";if(!keyNameMap[kmapI]){var keys="",p=kname;var dn=!isOne?kname.lastIndexOf("."):kname.indexOf("."),qn=0;if(dn===-1){qn=!isOne?kname.lastIndexOf("["):kname.indexOf("[")}var vlast=Math.max(qn,dn);if(vlast>0){p=kname.substr(0,vlast);keys=kname.substr(dn>0?vlast+1:vlast)}keyNameMap[kmapI]=[p,keys,kname]}return keyNameMap[kmapI]}var ksaTpl={EL:$(Config.el)[0],DOM:"",isMonitor:$.isset(Config.isMonitor)?Config.isMonitor:true,data:Config.data||{},methods:Config.methods||{},Template:Config.tpl,debug:Config.debug,Html:"",cache:{},ECODE:[],init:function(){var ths=this;ths.markMethods(ths.methods);var codeIsScript=ths.EL&&ths.EL.tagName==="SCRIPT";if(ths.Template){if(codeIsScript){ths.Template=ths.Template.trim()}ths.ECODE=ths.vdom(ths.formatHTML());var newDom=ths.parseVDOMcode(ths.ECODE);ths.DOM=newDom;ths.Html=$(newDom).html();if(newDom){delete ths.ECODE;if(ths.EL){if(codeIsScript){$(ths.EL).after(newDom).remove()}else{$(ths.EL).html(newDom)}}}}if(Config.methods){Object.defineProperty(Config.methods,"$data",{value:function(){return ths.data},enumerable:false,writable:false})}Config.init&&Config.init(ths);return ths},formatHTML:function(){var code=this.Template;code=code.replace(/{{(.*?)}}/g,function(){var str=arguments[1].trim();str=str.replace("&lt;","<");str=str.replace("&gt;",">");str=str.replace("&amp;","&");str=str.replace("&amp;","&");str=str.replace("&quot;",'"');str=str.replace("&nbsp;"," ");return"{{"+str+"}}"});var zIndex=0;var indexMap={loop:[],if:[]};code=code.replace(/{{(((if|loop)(\s+.*?))|(\/(if|loop)))}}/g,function(){var arg=arguments;if(arg[1].substr(0,1)==="/"){return"\x3c!--"+arg[1]+"-"+indexMap[arg[6]].pop()+"--\x3e"+"\n"}else{zIndex++;if(!indexMap[arg[3]]){indexMap[arg[3]]=[]}indexMap[arg[3]].push(zIndex);return"\x3c!--"+arg[3]+"-"+zIndex+""+arg[4]+"--\x3e"+"\n"}});code=code.replace(/{{(else|elseif\s.*?)}}/g,function(){return"\x3c!--"+arguments[1]+"--\x3e"+"\n"});code=code.replace(/{{eval\s+(.*?)}}/g,function(){return"\x3c!--eval "+arguments[1]+"--\x3e"});code=code.replace(/{{eval}}([\s\S]*?){{\/eval}}/g,function(){return"\x3c!--eval "+arguments[1].trim()+"--\x3e"});code=code.replace(/<(img|script|video|audio)(.*?)src="(.*?)"(.*?)>/gi,function(){var ag=arguments;return"<"+ag[1]+ag[2]+' _ksasrc_="'+ag[3]+'"'+ag[4]+">"});code=code.replace(/<(link)(.*?)href="(.*?)"(.*?)>/gi,function(){var ag=arguments;return"<"+ag[1]+ag[2]+' _ksahref_="'+ag[3]+'"'+ag[4]+">"});var dom=$.dom(code);if(!$.isArray(dom)){dom=[dom]}return dom},setAttrs:function(ele,key,value){if(!ele){return}if(!ele._KSA){ele._KSA={}}if(!$.isset(key)){return}if(!$.isset(value)&&$.isset(ele._KSA[key])){delete ele._KSA[key]}else{ele._KSA[key]=value}},getAttrs:function(ele,key){if(!ele._KSA){ele._KSA={}}return $.isset(key)&&$.isset(ele._KSA[key])?ele._KSA[key]:null},vdom_loop:function(ele){if(ele.nodeType===8&&ele.textContent.indexOf("loop-")===0){ele.isKsaNode=1;var farr=$.explode(" ",ele.textContent,"");farr[2]=farr[2]||"__value";var loopExp=[farr[0],farr[1],farr[3]?farr[2]:"__",farr[3]?farr[3]:farr[2]];var rcode="_$$_.LOOP("+loopExp[1]+", function("+loopExp[2]+", "+loopExp[3]+"){ return ";var scop=[],scopEnd=0;$(ele).nextAll("",true).each(function(i,e){if(!scopEnd){if(e.nodeType===8&&e.textContent.indexOf("/"+loopExp[0])===0){scopEnd=1}else{scop.push(e)}}});rcode+=this.vdom(scop);rcode+="})";return rcode}return""},vdom_if:function(ele){var ths=this;if(ele.nodeType===8&&ele.textContent.indexOf("if-")===0){ele.isKsaNode=1;var scop={},scopEnd=0;var ifName=ele.textContent.substr(0,ele.textContent.indexOf(" "));var scopIndex=0;var factor=ele.textContent.substr(ifName.length);var nodeName="if";$(ele).nextAll("",true).each(function(i,e){var nodeVal=e.textContent;var nodeType=e.nodeType;if(!scopEnd){if(nodeType===8&&nodeVal.indexOf("/"+ifName)===0){scopEnd=1}else{if(nodeType===8&&(nodeVal.indexOf("elseif ")===0||nodeVal==="else")){scopIndex++;if(nodeVal==="else"){factor="";nodeName="else"}else{factor=nodeVal.substr(7);nodeName="elseif"}e.isKsaNode=1}if(!scop[scopIndex]){scop[scopIndex]={name:nodeName,dom:[],factor:factor}}scop[scopIndex].dom.push(e)}}});var rcode=[];$.loop(scop,function(value){var exp=ths.parseText("{{"+value.factor+"}}");var factor=[];$.loop(exp[1],function(v,k){if($.isObject(v)){factor.push("["+k+', ["'+Object.keys(v).join('","')+'"]]')}else{factor.push('[null, "'+k+'"]')}});if(factor.length){factor="["+factor.join(",")+"]"}else{factor='""'}var code="";if(value.name==="else"){code='["else","", function(){return'}else{code="[function(){ return "+value.factor+"}, "+factor+", function(){return "}code+=ths.vdom(value.dom);code+="}]";rcode.push(code)});if(rcode.length){return"_$$_.IF("+rcode.join(", ")+")"}return""}},vdomAttr:function(ele){var ths=this;var attrs;if(ele.nodeType===1&&ele.attributes&&ele.attributes.length){attrs=[];var attrsIsP=[];$.loop(ele.attributes,function(v){var value=v.value,key=v.name;key=key==="_ksasrc_"?"src":key;key=key==="_ksahref_"?"href":key;if(key.substr(0,1)==="@"){return}var ep=ths.parseText(value);value=ep[0];if($.isObject(ep[1])){$.loop(ep[1],function(kv,kn){if($.isObject(kv)){attrsIsP.push("['"+key+"', "+kn+", '"+Object.keys(kv).join(",")+"']")}else{attrsIsP.push("['"+key+"', null, '"+kn+"']")}})}if(key==="v-model"||key==="v-modeltext"){var upbj=keyName(v.value);if(upbj[0]){if(!upbj[1]){upbj[1]=upbj[0];upbj[0]="_$data_"}attrs.push('"v-model":[(typeof('+upbj[0]+"."+upbj[1]+') !=="undefined" ? '+upbj[0]+' : ""), "'+upbj[1]+'", '+(key==="v-modeltext")+"]")}}else if(key.substr(0,1)===":"){attrs.push('"'+key+'":function(){ return '+(value||'""')+"}")}else{attrs.push('"'+key+'":'+(value||'""')+"")}});if(attrs.length>0){attrs="{"+attrs.join(",")+"}";if(attrsIsP.length){attrs="[function(){return "+attrs+"}, ["+attrsIsP.join(",")+"]]"}}else{attrs=""}}return attrs},vdomEval:function(ele){if(ele.nodeType===8&&ele.textContent.indexOf("eval")===0){return ele.textContent.substr(4)}},vdom:function(eleList,isScore){var ths=this;var Enode=[];$.loop(eleList,function(ele){var nodeType=ele.nodeType;if(ele._vdomBreak||nodeType===8&&(ele.textContent.indexOf("/if")===0||ele.textContent.indexOf("/loop")===0)){return}ele._vdomBreak=true;var tag=ele.tagName?ele.tagName:"";var rcode="",monitor="";var EvalCode=ths.vdomEval(ele);if(EvalCode){rcode+="_$$_.F(function(){"+EvalCode+" \n\nreturn _$$_.D(";rcode+=ths.vdom($(ele).nextAll("",true));rcode+=");})";nodeType=1}else{var attrs=ths.vdomAttr(ele);if($.inArray(nodeType,[3,8])){if(nodeType===8){var tmprcode=ths.vdom_loop(ele);if(!tmprcode){tmprcode=ths.vdom_if(ele)}if(tmprcode){rcode+=tmprcode;tmprcode=null;nodeType=1}}if(!ele.isKsaNode){var exp=ths.parseText(ele.textContent,ele);if(exp&&exp[0]){rcode+=exp[0];if(exp[1]){$.loop(exp[1],function(skv,vname){if($.isObject(skv)){monitor+="_$$_.M(arguments[0], "+vname+", '"+Object.keys(skv).join(" ")+"');\n"}else if(typeof ths.data[vname]!=="undefined"){monitor+="_$$_.M(arguments[0], _$data_, '"+vname+"');\n"}else if(typeof window[vname]!=="undefined"){monitor+="_$$_.M(arguments[0], window, '"+vname+"');\n"}})}}exp=null}}if(ele.childNodes&&ele.childNodes.length){rcode+=ths.vdom(ele.childNodes)}}monitor=monitor?"function(){"+monitor+"}":'""';var events=[];$.loop(ele.attributes,function(val){if(val.name.substr(0,1)==="@"){if(!events){events={}}events.push('"'+val.name.substr(1)+'": function($e){return (function(){var _$this_return$_ = '+val.value+"; return _$this_return$_}).apply(this,$e);}")}});events=events.length?"{"+events.join(",")+"}":'""';rcode='_$$_.F(function(){return _$$_.C((arguments[0]||"'+tag+'"), '+nodeType+", "+(attrs||'""')+", "+(rcode||'""')+")}, "+monitor+", "+events+")";Enode.push(rcode)});var length=Enode.length;if(length===1){Enode=Enode[0]}else if(isScore){Enode=Enode.join("")}else if(!isScore&&length>1){Enode="["+Enode.join(", ")+"]"}else{Enode=""}return Enode},vUpdateModel:function(){var ele=$(arguments[0]),tag=ele[0].tagName,type=ele.attr("type"),obj=arguments[1][0],key=arguments[1][1],isText=!!arguments[1][2];type=type&&type.indexOf("ks-")===0?type.substr(3):type;if($.isObject(obj)){var ths=this;var objID=$.objectID(obj);ths.cache.vUpdateModelinput=ths.cache.vUpdateModelinput||{};var cache=ths.cache.vUpdateModelinput;cache[objID]=cache[objID]||{};if(!cache[objID][key]){cache[objID][key]={ele:{},isPush:false,func:function(value,k){$.loop(ths.cache.vUpdateModelinput[objID][k].ele,function(e,tp){$(e).val(value)})}}}cache[objID][key].ele[type]=cache[objID][key].ele[type]||[];cache[objID][key].ele[type].push(ele[0]);if(tag==="INPUT"&&$.inArray(type,["checkbox","radio"])){ele.change(function(){var v=[];$(cache[objID][key].ele[type]).map(function(e){if(e.checked){v.push(isText&&e.parentElement.nodeName==="LABEL"?e.parentElement.textContent:$(e).attr("value"))}});obj[key]=v})}else if(tag==="INPUT"||tag==="TEXTAREA"){ele.on("input KSADOMchange",function(){obj[key]=ele.val()})}else if(tag==="SELECT"){ele.change(function(){obj[key]=isText?ele.find("option:selected").text():ele.val()})}ele.val(obj[key]);if(!cache[objID][key].isPush){$.def.createEvent("set",obj,key,cache[objID][key].func);cache[objID][key].isPush=true}}},markMethods:function(methods){if(!methods){return}var ths=this;$.loop(methods,function(value,key){if($.isFunction(value)){Object.defineProperty(value,"_isKSAtplEvent",{value:true,enumerable:false,writable:true})}else if($.isObject(value)){ths.markMethods(value)}})},parseVDOMcode:function(_EvalCodes){var ths=this;var invars=[];var ginvars=[];var globalVar=[];globalVar.push("this.__proto__.KSAglobal = function(){");$.loop(this.data,function(value,key){var svs="_$data_"+($.isNumber(key)?"["+key+"]":"."+key);invars.push("var "+key+" = "+svs+";");globalVar.push(key+" = _$data_."+key+";")});globalVar.push("};");$.loop(this.methods,function(value,key){invars.push("var "+key+" = function(){return _$methods_."+key+".apply(_$methods_, arguments);};")});invars=invars.join("\n");if(ths.isMonitor){invars+="\n"+globalVar.join("\n")}ginvars=ginvars.join("\n");_EvalCodes=invars+"\n"+ginvars+" \n return _$$_.D("+_EvalCodes+")";if(ths.debug){_EvalCodes="console.error(new Error('Evalcode回调'));"+_EvalCodes}var Es=new Function("_$tpl_, _$data_ , _$methods_",'"use strict"; var _$$_ = this; '+_EvalCodes+"");if(ths.isMonitor){if(!ths.data.__proto__.__ksaUpdate__){Object.defineProperty(ths.data.__proto__,"__ksaUpdate__",{value:function(){Es.prototype.KSAglobal();return this},enumerable:false,writable:false})}$.def.createEvent("set",ths,"data",function(){})}Es.prototype.F=function(Cfunc,Mfunc,event){var ele=Cfunc();ths.setAttrs(ele,"renderFunction",function(){Cfunc(ele)});Mfunc&&Mfunc(ele);$.loop(event,function(func,name){$(ele).on(name,function(){var R=func.call(this);if(R&&$.isFunction(R)&&R._isKSAtplEvent){R=R.call(this)}return R})});return ele};Es.prototype.C=function(){var _ts=this;var tag=arguments[0];var nodeType=arguments[1],attrs=arguments[2],textContent=arguments[3],monitorFunc=arguments[4];if($.isNull(textContent)||textContent===undefined){textContent=""}if($.isObject(tag)&&tag.nodeType){tag.textContent=textContent;$(tag.parentElement).trigger("KSADOMchange",["html",textContent]);return tag}var ele;if($.isArray(tag)){ele=document.createDocumentFragment();$.loop(tag,function(e){if($.isArray(e)){e=_ts.C(e)}e&&ele.appendChild(e)})}else if(nodeType===11){}else{switch(nodeType){case 3:ele=document.createTextNode(textContent);break;case 8:ele=document.createComment(textContent);break;default:if(!tag){ele=document.createDocumentFragment()}else{ele=document.createElement(tag)}if($.isArray(textContent)){$.loop(textContent,function(e){if(e){ele.appendChild(e)}})}else if(textContent&&$.isObject(textContent)&&textContent.nodeType){ele.appendChild(textContent)}}if(attrs){var insetattr;if($.isArray(attrs)){insetattr=attrs[0]();if(attrs[1]){$.loop(attrs[1],function(v){if(!v[1]){v[1]=$.isset(ths.data[v[2]])?ths.data:window}$.def.createEvent("set",v[1],v[2],function(){var e=$(ele);$.loop(attrs[0](),function(attrVal,attrK){var attrV=attrVal===""?attrK:attrVal;if(attrK===v[0]){if(attrK=="v-html"){e.html(attrVal.toString());return}if(attrK.substr(0,1)===":"){var sAv=attrV();e.attr(attrK.substr(1),sAv?sAv:"")}else{e.attr(attrK,attrV)}}})})})}}else{insetattr=attrs}if($.isObject(insetattr)){var el=$(ele);$.loop(insetattr,function(v,k){if(k==="v-model"){ths.vUpdateModel(ele,v)}else if(k==="v-html"){el.html(v.toString())}else if(k.substr(0,1)===":"){var sval=v();el.attr(k.substr(1),sval?sval:"")}else if(k.substr(0,1)=="@"){}else{v=v===undefined||v===""?true:v;el.attr(k,v)}})}}}if(monitorFunc){monitorFunc(ele)}return ele};Es.prototype.M=function M(ele,obj,objKey,at){var func=ths.getAttrs(ele,"renderFunction");if(!func){return}$.def.createEvent("set",obj,objKey,function(){var arg=[ele];$.loop(arguments,function(v){arg.push(v)});func.apply(ele,arg)})};Es.prototype.D=function(element){if(!element){return}var dom=document.createDocumentFragment();if($.isArray(element)){$.loop(element,function(e){if(e){if($.isArray(e)){$.loop(e,function(v){dom.appendChild(v)})}else{dom.appendChild(e)}}})}else{dom.appendChild(element)}return[].slice.call(dom.childNodes)};Es.prototype.LOOP=function(dt,func){if(!dt){return}var _ts=this;var loopCache={};var newEle=document.createDocumentFragment();var valueOld={};function pushNode(value,key){dt[key]=value;var node=func.call("",key,value);if($.isArray(node)){node=_ts.C(node)}$.def.createEvent("delete",dt,key,function(){var lastDom;if($.count(loopCache)===1){var objkeys=Object.keys(loopCache);lastDom=loopCache[objkeys[objkeys.length-1]][0];if(lastDom){_loopcreateCom();$(lastDom).before(loopCache.Placeholder)}}$.loop(loopCache[key],function(e){$(e).remove()});delete loopCache[key]});valueOld[key]=value;return node}function _loopcreateCom(){var node=document.createComment("KSA-Placeholder:loop");node._KSA_Placeholder=1;loopCache.Placeholder=node;return node}$.loop(dt,function(value,key){loopCache[key]=loopCache[key]||[];var node=pushNode(value,key);var nodes;if(node.nodeType===11){nodes=[].slice.call(node.childNodes)}else{nodes=[node]}newEle.appendChild(node);$.loop(nodes,function(v){loopCache[key].push(v)})});function _addFun(value,key){var lastDom=loopCache.Placeholder;if(value===dt[key]&&loopCache[key]){return}loopCache[key]=[];var node=pushNode(value,key);if(node.nodeType===11){$.loop(node.childNodes,function(v){loopCache[key].push(v)})}else{loopCache[key].push(node)}if(!lastDom){var objKeys=Object.keys(loopCache);var prevV;$.loop(objKeys,function(sv,sk){if(sv==key){if(sk===0){var currCache=loopCache[objKeys[sk+1]];if(currCache){lastDom=currCache[0];$(lastDom).before(loopCache[key])}}else{var currCache=prevV[prevV.length-1];if(currCache){lastDom=currCache;$(lastDom).after(loopCache[key])}}return true}prevV=loopCache[sv]});prevV=null}else{$(lastDom).after(loopCache[key])}if(loopCache.Placeholder){$(lastDom).remove();delete loopCache.Placeholder}}$.def.createEvent("add",dt,_addFun);if(!$.count(loopCache)){newEle.appendChild(_loopcreateCom())}return newEle};Es.prototype.IF=function(){var ifKey=$.autoID("ktpl-parseIF");if(!ths.cache.ifscope){ths.cache.ifscope={}}var Args=arguments;function _factor(){var index=null;$.loop(Args,function(value,i){if($.isNull(index)&&(value[0]==="else"||value[0]())){index=i;return true}});return index}function _parse(index){var dom;if(index!==null){dom=Args[index][2]()}if(!dom){dom=[document.createComment("KSA-Placeholder:if")]}else if(!$.isArray(dom)){dom=[dom]}return dom}var monObj={};$.loop(arguments,function(value){$.loop(value[1],function(val){var objID;if(val[0]===null){var f=$.isset(ths.data[val[1]])?ths.data:window;objID=$.objectID(f);monObj[objID]=monObj[objID]||[f,[]];monObj[objID][1].push(val[1])}else{objID=$.objectID(val[0]);monObj[objID]=monObj[objID]||[val[0],[]];$.loop(val[1],function(kname){monObj[objID][1].push(kname)})}})});var ifIndex=_factor();var pushDom=_parse(ifIndex);function monFunc(){var index=_factor();if(index!==ifIndex){var lastDom=pushDom[pushDom.length-1];var dom=_parse(index);$(lastDom).after(dom);$(pushDom).remove();pushDom=dom;ifIndex=index}}$.loop(monObj,function(value){$.loop(value[1],function(kname){$.def.createEvent("set reset add delete",value[0],kname,monFunc)})});return pushDom};return new Es(ths,ths.data,ths.methods)},extractParamName:function(str){if(!this.cache.extractParamName){this.cache.extractParamName={}}var cacheK=str;if(!this.cache.extractParamName[cacheK]){var strArr=[];str=str.replace(/['"]/g,"").replace(extractReg[0],"$1");str=str.replace(extractReg[1],"|$2");var S="";for(var i=0;i<str.length;i++){var value=str[i];if(extractReg[2].test(value)){strArr.push([S,value]);S=""}else{S+=value}}if(S){strArr.push([S,""])}var Vars={};for(var i=0;i<strArr.length;i++){var value=strArr[i],val=value[0];val=val.trim();if(val!==""){val=val.replace(/^('.*?')|(".*?")$/g,"")}val.replace(/\[([a-z$_][^\]]+)]/gi,function(){Vars[arguments[1]]=arguments[1]});if(val&&value[1]!=="("&&/^[a-z$_]/i.test(val)){Vars[val]=val}}this.cache.extractParamName[cacheK]=Object.keys(Vars)}return this.cache.extractParamName[cacheK]},parseText:function(text,ele){if(!this.cache.parseTextIndex){this.cache.parseTextIndex={}}var ths=this;var parseDt=[];var parseTextIndex=this.cache.parseTextIndex;if(text&&text.trim()){if(parseTextIndex[text]){parseDt=parseTextIndex[text]}else{var parseCode=[];var variableList={};var tagRE=variableReg;var lastIndex=tagRE.lastIndex=0;var match,index;while(match=tagRE.exec(text)){index=match.index;if(index>lastIndex){parseCode.push(strToQuotes(text.slice(lastIndex,index)))}var kname=match[1].trim();$.loop(ths.extractParamName(kname),function(v){var skv=keyName(v);if(ths.isMonitor&&!$.inArray(skv[0],["false","true","null","undefined"])){if(skv[1]){variableList[skv[0]]=$.isObject(variableList[skv[0]])?variableList[skv[0]]:{};variableList[skv[0]][skv[1]]=1}else{variableList[skv[0]]=1}}});parseCode.push(kname);lastIndex=index+match[0].length}if(lastIndex<text.length){parseCode.push(JSON.stringify(text.slice(lastIndex)))}parseCode=parseCode.length?parseCode.join("+"):null;if(parseCode){parseCode=torn(parseCode)}variableList=$.isEmpty(variableList)?null:variableList;parseDt=[parseCode,variableList];parseTextIndex[text]=parseDt}if(ele){ths.setAttrs(ele,"parseCode",parseDt[0]);ths.setAttrs(ele,"variableList",parseDt[1])}}else{text=torn(text);parseDt=[strToQuotes(text)]}return parseDt}};return ksaTpl.init()};$.isWindow=function isWindow(obj){return $.isObject(obj)&&obj===obj.window};$.isDocument=function(obj){return $.isObject(obj)&&obj.nodeType==obj.DOCUMENT_NODE};$.isArray=function(v){return $.isObject(v)&&v.constructor==Array};$.isset=function(key,str){if(str!==undefined){return key.indexOf(str)===-1}else{return typeof key!=="undefined"}};$.isTrue=function(v){return v===true};$.isFalse=function(v){return v===false};$.isArrayLike=function(obj){if($.isFunction(obj)||$.isWindow(obj)||$.isString(obj)||$.isNumber(obj)){return false}var length=!!obj&&"length"in obj&&obj.length,type=typeof obj;return type==="array"||length===0||typeof length==="number"&&length>0&&length-1 in obj};$.isLoop=function(obj){var length=!!obj&&"length"in obj&&obj.length,type=typeof obj;return type==="array"||length===0||typeof length==="number"&&length>0&&length-1 in obj};$.isNumber=function(v){var tp=typeof v;return(tp==="string"||tp==="number")&&!isNaN(v)};$.isBool=function(v){return typeof v==="boolean"};$.isObject=function(v){return v&&typeof v==="object"};$.isObjectPlain=function(v){return $.isObject(v)&&!$.isWindow(v)&&Object.getPrototypeOf(v)===Object.prototype};$.isString=function(v){return typeof v==="string"};$.isFunction=function(v){return v&&typeof v==="function"};$.isEmpty=function(v){if($.isObject(v)){return Object.keys(v).length===0}else{return v===""||v===undefined}};$.isDomAll=function(dom){if(!dom||$.isString(dom)){return}return dom instanceof HTMLElement||dom instanceof Node||dom instanceof NodeList||$.isObject(dom)&&dom.nodeType&&$.isString(dom.nodeName)};$.isIndom=function(e){return e&&e instanceof HTMLElement&&!$.inArray(document.compareDocumentPosition(e),[35,37])};$.isNull=function(v){return v===null};$.inArray=function(val,dt,rkey){var S=false,valisArr=$.isArray(val);$.loop(dt,function(v,k){if(valisArr&&$.inArray(v,val)||!valisArr&&val==v){S=rkey?k:true;return S}});return S};$.count=function(dt){if($.isArray(dt)){return dt.length}else if($.isObject(dt)){var S=0;$.loop(dt,function(){S++});return S}};$.arrayMerge=function(){var arr=arguments[0]||{};$.loop(arguments,function(value,key){if(key>0&&$.isObject(value)){$.loop(value,function(val,k){arr[k]=val})}});return arr};$.toArray=function(dt){var tp=typeof dt;if($.isArray(dt)){return dt}else if(tp==="object"){if(dt instanceof HTMLElement||dt instanceof Node){return[dt]}else if(dt instanceof NodeList){return[].slice.call(dt)}else if(dt instanceof $){var newdt=[];dt.each(function(_,e){newdt.push(e)});return newdt}}else{return[dt]}};$.explode=function(ft,str,notemp){str=ft&&str?str.toString().split(ft):[];if(!str.length){return[]}if($.isset(notemp)){var news=[];$.loop(str,function(v){if(v!=notemp){news.push(v)}});str=news}return str};$.implode=function(n,arr){var s="",str="";$.loop(arr,function(v){str+=s+v;s=n});return str};$.unset=function(dt,keys){var at=$.isObject(dt)?"object":$.isArray(dt)?"array":null;if(at){keys=$.explode(" ",keys,"");$.loop(dt,function(v,k){if($.inArray(k,keys)){if(at=="object"){delete dt[k]}else{dt.splice(k,1)}}})}return dt};$.trim=function(str,char){str=str.toString();if(char){str=str.replace(new RegExp("^\\"+char+"+","g"),"");str=str.replace(new RegExp("\\"+char+"+$","g"),"")}else{str=str.trim()}return str};function _intval(value,isFloat){if($.isObject(value)||$.isArray(value)){$.loop(value,function(v,k){value[k]=_intval(v,isFloat)})}else{value=(isFloat?parseFloat(value):parseInt(value))||0}return value}$.intval=function(value){return _intval(value)};$.floatval=function(value){return _intval(value,true)};$.strpos=function(str,val,len){str=str.toString();str=len>0?str.substr(len):str;if($.isArray(val)){var check=false;$.loop(val,function(v){if(str.indexOf(v)!==-1){check=true;return true}});return check}else{return str.indexOf(val)!==-1}};$.strlen=function(value){return value.toString().length};K.focus=function(fun){if(fun){this.on("focus",fun)}else{this[0]&&this[0].focus()}return this};$.callStrEvent=function(code,param){code=code.trim();var fun=window[code]?window[code]:new Function("return "+code);return fun&&$.isArray(param)?fun.apply(this,param):fun.call(this,param)};$.loop("input blur focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change keydown keypress keyup contextmenu touchstart touchmove touchend".split(" "),function(name){K[name]=function(func,fn){return arguments.length>0?this.on(name,null,func,fn):this.trigger(name)}});$(document).on("DOMContentLoaded.ksa",function(){$.loop(DocumentReadyFunction,function(func){func()});DocumentReadyFunction=[];$(document).off("DOMContentLoaded.ksa")});$.extend=$.arrayMerge;K.innerWidth=function(){return this.width(true)};K.innerHeight=function(){return this.height(true)};K.outerWidth=function(){return this.width(true,true)};K.outerHeight=function(){return this.height(true,true)};var requireScript=document.currentScript?document.currentScript:document.scripts[document.scripts.length-1];var requireDir=requireScript.src.substr(0,requireScript.src.lastIndexOf("/")+1);$.require=function(){var args=arguments;if(!args.length){args=$.explode(" ",requireScript.getAttribute("module"),"");if(!args.length){return}}$.loop(args,function(value){var exp=value.substr(value.lastIndexOf("."));exp=exp?exp.toLowerCase():exp;var isCSS=exp===".css";value="module/"+value+(exp?"":".js");var file=document.createElement(isCSS?"link":"script");if(isCSS){file.href=requireDir+value;file.type="text/css";file.rel="stylesheet"}else{file.src=requireDir+value;file.type="text/javascript"}$(requireScript).after(file)})};$.require();$.plugin=$.prototype;window.KSA=window.$=$;return $})(document);