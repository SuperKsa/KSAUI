if("undefined"==typeof KSA)throw Error("\u5f53\u524d\u7ec4\u4ef6table\u9700\u8981KSA\u652f\u6301");$.table=function(d){function h(a,b){var c=$((event||window.event).target),e="";$.loop(a,function(a,c){if(!a["if"]||$.isFunction(a["if"])&&a["if"](b))e+=$.tag("p",{style:a.style,href:a.url,icon:a.icon,"dropdown-event-key":c},a.text)});e=$(e);e.filter("[dropdown-event-key]").map(function(c){c=$(c);var e=c.attr("dropdown-event-key");a[e]&&c.click(function(){a[e].event(b)})});c.active()||(c.active(!0),$.layer({pos:c,cover:0,content:e,closeBtn:0,bodyOver:!1,init:function(a){a.addClass("ks-layer-showmenu")},show:function(a){$(document).on("click.KSAUI-dropdown",function(b){b.target!==a[0]&&($.layerHide(a.layerID),$(document).off("click.KSAUI-dropdown"))})},close:function(){c.active(!1)}}))}$._tableID=$._tableID||0;d.data||(d.data={ksauiLoading:1,limit:0,page:1,list:[],count:0,maxpage:0,url:""});var k=function(){d.endFun&&d.endFun.call(d,d.el)};$._tableID++;return{options:d,el:$(d.el),$data:d.data,post:{},tplObj:{},page:1,tableClass:"ks-table-list-"+$._tableID,init:function(){var a=this;a.dom=a.createHtml();a.tplObj=$.tpl({debug:d.debug,el:a.el,tpl:a.dom,data:a.$data,init:function(){a.el=$(this.el)},render:function(){a.el=$(this.el)},methods:{options:function(){var b=arguments,c=a.options;0<b.length&&$.loop(b,function(a){c=c[a]});return c},btnEvent:function(b,c){[].slice.call(arguments);var e=d;$.loop($.explode(".",b),function(a){e=e[a]});e=$.isObject(e)&&e.event?e.event:e;$.isFunction(e)&&e.apply(a,[c,a.el,a]);if($.strpos(b,["lineBtn","lineSelect"]))return e.menu&&h(e.menu,c),!1},selectLine:function(b,c){var e=a.el.find('tr[data-key\x3d"'+b+'"]');e.find("input").checked()?e.addClass("ks-table-tr-checked"):e.removeClass("ks-table-tr-checked");d.lineSelect&&d.lineSelect.event&&d.lineSelect.event.apply(a,[c,a.el,a])},getSelect:function(){return a.getSelect()},refresh:function(){a.refresh()},toPages:function(b){a.get(window.event.target.value)},lineBtn:function(){debug(arguments)},_KSA_TABLE_END_:function(){this.$data.ksauiLoading||window.setTimeout(function(){k.call(a)})}}});this.get(1,function(b){a.bindEvent()});return this},refresh:function(){this.get(this.page)},get:function(a,b){var c=this;c.el.find(".ks-table-toolbar ks-btn[data-table-btnindex]").each(function(a,b){b=$(b);var c=b.data("table-btnindex"),e=d;$.loop(c.split("."),function(a){e=e[a]});e.disabled&&b.disabled(e.disabled)});var e=c.el.find("input[ischeckall]");e.length&&(e[0].checked=!0,e.checked(!1).trigger("changeALL"));c.page=a||1;c.post=$.arrayMerge({},d.post||{});d.search&&(c.post=$.arrayMerge(c.post,$(d.search).formData()));c.post=$.arrayMerge(c.post,{page:c.page});c.$data.ksauiLoading=1;$.API(d.listAPI,c.post,function(a){$.loop(a,function(a,b){$.tplSet(c.$data,b,a)});a.page&&(c.page=a.page);c.$data.ksauiLoading=0;b&&b.call(c,a);d.render&&d.render(c,a)})},createBtn:function(a,b,c,e){e=e?e:{};var d="";a&&($.isObject(a)?$.loop(a,function(a,g){var f=b?b+"."+g:"";$.isString(a)&&(a={text:a});d+=$.tag("ks-btn",$.arrayMerge({"data-table-btnIndex":f,"data-key":g,size:"small",icon:a.icon,color:a.color,style:a.style,disabled:a.disabled?"disabled":null,"@click":f?"btnEvent('"+f+"', "+(c||"''")+", this)":"",cap:a.cap,line:a.line},e),a.text)+" "}):d+=a);return d},getSelect:function(){var a=this,b=a.el.find("tr.ks-table-tr-checked"),c={};$.loop(b,function(b){b=$(b);b=b.data("key");a.$data.list&&$.isset(a.$data.list[b])&&(c[b]=a.$data.list[b])});return c},createHtml:function(){var a='\x3cdiv class\x3d"'+this.tableClass+'"\x3e';d.toolBtn&&(a+='\x3cdiv class\x3d"ks-table-toolbar ks-clear ks-plr1"\x3e',$.isObject(d.toolBtn)?(d.toolBtn.left&&(a+='\x3cdiv class\x3d"ks-fl ks-mr1-sub"\x3e'+this.createBtn(d.toolBtn.left,"toolBtn.left","getSelect()")+"\x3c/div\x3e"),a+='\x3cdiv class\x3d"ks-fr"\x3e\x3cspan class\x3d"ks-mr ks-text-gray ks-f1"\x3e\u5171{{count}}\u6761\x3c/span\x3e\x3cks-btn data-key\x3d"_refresh" size\x3d"small" icon\x3d"refresh" @click\x3d"refresh()"\x3e\u5237\u65b0\x3c/ks-btn\x3e\x3cks-btn-group class\x3d"ks-ml1"\x3e'+this.createBtn(d.toolBtn.right,"toolBtn.right","this")+"\x3c/ks-btn-group\x3e\x3c/div\x3e"):$.isString(d.toolBtn)&&(a+=d.toolBtn),a+="\x3c/div\x3e");a+='\x3cdiv class\x3d"ks-pos"\x3e';a+='{{if ksauiLoading}}\x3cdiv class\x3d"ks-pos-1" style\x3d"width: 100%; height: 100%; z-index: 99; text-align: center; color: #9a9a9a; background: rgba(255,255,255,.8); padding-top: 80px"\x3e\x3cspan icon\x3d"loader" class\x3d"ks-text-primary" style\x3d"font-size: 2.5em"\x3e\x3c/span\x3e\x3c/div\x3e{{/if}}';a+='\x3ctable class\x3d"ks-table" line hover\x3e';a+="\x3cthead\x3e\x3ctr\x3e";d.lineSelect&&(a+='\x3cth width\x3d"45"\x3e\x3cinput type\x3d"ks-checkbox-all" name\x3d"__checkall__" selector\x3d".'+this.tableClass+'" value\x3d"" @change\x3d"btnEvent(\'lineSelect\');"\x3e\x3c/th\x3e');$.loop(d.colData,function(b,c){$.isset(b.show)&&!b.show&&(b.style=b.style?b.style:"",b.style+="display:none;");a+=$.tag("th",{"data-field":c,style:b.style,width:b.width},b.name)});d.lineBtn&&(a+='\x3cth width\x3d"160"\x3e\u64cd\u4f5c\x3c/th\x3e');a+="\x3c/tr\x3e\x3c/thead\x3e";a+="\x3ctbody\x3e";a+="{{if !count}}";a+='\x3ctr\x3e\x3ctd colspan\x3d"999"\x3e\x3cks-empty\x3e\u6682\u65e0\u6570\u636e\x3c/ks-empty\x3e\x3c/td\x3e\x3c/tr\x3e';a+="  {{else}}  ";a+=" {{loop list key value}} ";a+='\x3ctr :trlist\x3d"key" :data-key\x3d"key"  '+(d.lineDblclick?" @dblclick\x3d\"btnEvent('lineDblclick', value)\"":"")+" "+(d.lineClick?" @click\x3d\"btnEvent('lineClick', value)\"":"")+"\x3e";d.lineSelect&&(a+='\x3ctd\x3e\x3cinput type\x3d"ks-checkbox" name\x3d"__checkall__" :data-ks-line-key\x3d"key" :value\x3d"value.'+d.lineSelect.field+'" @change\x3d"selectLine(key, value);"\x3e\x3c/td\x3e');$.loop(d.colData,function(b,c){$.isset(b.show)&&!b.show&&(b.style=b.style?b.style:"",b.style+="display:none;");"price"==b.type?b.tpl=$.tag("ks-price",{color:b.color,style:b.style,unit:b.unit,":value":"value."+c+""},""):"tag"==b.type?b.tpl=$.tag("ks-tag",{color:b.color,icon:b.icon,style:b.style},"{{value."+c+"}}"):"switch"==b.type&&(b.tpl=$.tag("input",{type:"ks-switch",color:b.color,icon:b.icon,style:b.style,":checked":"value."+c+" \x3e 0 || value."+c+" \x3d\x3d true ? true : false",":text":"options('colData', '"+c+"', 'text')"}));var d=b.option?'{{options("colData", "'+c+'", "option", value.'+c+")}}":"{{value."+c+"}}";a+=$.tag("td",{style:b.style},b.tpl?b.tpl:d)});d.lineBtn&&(a+='\x3ctd :data-linebtn-key\x3d"key"\x3e'+this.createBtn(d.lineBtn,"lineBtn","value",{":data-line-key":"key"})+"\x3c/td\x3e");a+="\x3c/tr\x3e";a+="{{/loop}}";a+="{{/if}}";a+="\x3c/tbody\x3e";a+="\x3c/table\x3e\x3c/div\x3e";a+='{{if maxpage \x3e 1}}\x3cdiv class\x3d"ks-tc ks-mt ks-mb5"\x3e\x3cks-page :current\x3d"page" :total\x3d"maxpage" @change\x3d"toPages()"\x3e\x3c/ks-page\x3e\x3c/div\x3e{{/if}}\x3c/div\x3e';return a+="{{_KSA_TABLE_END_()}}"},bindEvent:function(){var a=this;d.search&&$(d.search).submit(function(){a.get(1);return!1})}}.init()};