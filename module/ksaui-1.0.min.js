$.ZINDEX=999;$.WINID=1;$.W=0;$.H=0;$.mouseX=0;$.mouseY=0;$.device="PC";$.deviceView=0;$.ksauiRenderTree={};(function($){var UserAgent=navigator.userAgent;$.IE=_getIEversion();$.IE>0&&$("html").addClass("ks-ie"+$.IE+" ks-ie");function _getIEversion(){var ie=UserAgent.match(/msie\s([\d.]+)/i);var ie11=UserAgent.match(/trident\/([\d.]+)/i);return parseInt(ie&&ie[1]?ie[1]:ie11&&ie11[1]?"11":"0")}$.isMobile=false;$.isWechat=false;$.W=window.innerWidth;$.H=window.innerHeight;var agent=navigator.userAgent.toLowerCase();if(/android|ipad|iphone/.test(agent)||/mac os/.test(agent)&&$.W<$.H){$.device="MOBILE";$.isMobile=true;$("html").attr("mobile","true").attr("device","mobile");$.isWechat=/microMessenger/i.test(agent)}if($.device=="PC"){$(document).on("mousemove",function(e){$.mouseX=e.x||e.layerX||0;$.mouseY=e.y||e.layerY||0});$("html").attr("device","pc")}$(window).resize(function(){$.W=window.innerWidth;$.H=window.innerHeight});function _KSArenderStart(){function _documentRenderFun(option,ele,selector,update){if(!ele._KSAUIRENDER_){ele._KSAUIRENDER_={}}if(option.monitor.length){$.loop(option.monitor,function(val){var isCall;if(update.type==="attributes"){isCall=val=="attr."+update.attributeName?update.attributeName:null}else if(val=="html"&&update.type==="childList"){isCall=val}if(isCall){option.callback&&option.callback.call(ele,ele,true,val)}})}if(!ele._KSAUIRENDER_[selector]){ele._KSAUIRENDER_[selector]=true;option.callback&&option.callback.call(ele,ele)}}function _documentRender(ele,update){if(ele.nodeType!==1){return}ele=$(ele);$.loop($.ksauiRenderTree,function(option,selector){ele.find(selector).map(function(el){_documentRenderFun(option,el,selector,update)});var thisEl=ele.filter(selector);thisEl.length&&_documentRenderFun(option,thisEl[0],selector,update)})}var MutationObserver=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver;if(MutationObserver){var observer=new MutationObserver(function(Mut){$.loop(Mut,function(val){if(val.type==="childList"&&val.addedNodes.length){$.loop(val.addedNodes,function(ele){if(ele.nodeType===1&&$.isIndom(ele)){_documentRender(ele,val)}})}else if(val.type==="attributes"){_documentRender(val.target,val)}})});observer.observe(document,{characterDataOldValue:true,attributeOldValue:true,attributes:true,childList:true,subtree:true})}else{$(document).on("DOMContentLoaded DOMNodeInserted",function(Mut){if(Mut.type==="DOMNodeInserted"){_documentRender(Mut.target)}else{$.loop(document.body.children,function(ele){_documentRender(ele)})}})}}$.render=function(selector,func,monitor){var newMonitor=[];$.loop($.explode(" ",monitor),function(val){val=$.trim(val);if(val){newMonitor.push(val)}});if($.isObject(selector)&&!func){$.loop(selector,function(val,key){$.ksauiRenderTree[key]={callback:val,monitor:newMonitor}})}else{$.ksauiRenderTree[selector]={callback:func,monitor:newMonitor}}};$.BackEvent=function(id,showID){var $this=this;$this.BackEventData=$this.BackEventData?$this.BackEventData:{};$this.BackEventData.doms=$this.BackEventData.doms?$this.BackEventData.doms:{};var Url=window.location.href;var idMrk="#"+id;if(showID){if(Url.indexOf(idMrk)==-1){location.hash+=idMrk}$this.BackEventData.doms[id]=showID}else{if(Url.indexOf(idMrk)!=-1){var newevn={};$.loop($this.BackEventData.doms,function(v,k){if(k!=id){newevn[k]=v}});$this.BackEventData.doms=newevn;window.history.go(-1)}return}if(!$this.BackEventData.init){$this.BackEventData.init=1;$(window).on("popstate",function(){var u=window.location.href.indexOf("#");u=u==-1?"":window.location.href.substr(u);var urlexps={};$.loop($.explode("#",u),function(value){if(value){urlexps[value]=value}});var newevn={};$.loop($this.BackEventData.doms,function(v,k){if(!urlexps[k]){$.layerHide($(v).attr("key"))}else{newevn[k]=v}});$this.BackEventData.doms=newevn})}};$.resize=function(Fun,ime){var $this=this;if(ime==1||ime==3){Fun(window.innerWidth,window.innerHeight)}else if(ime==2||ime==3){$(document).ready(function(){Fun(window.innerWidth,window.innerHeight)})}$(window).resize(function(){Fun&&typeof Fun=="function"&&Fun(window.innerWidth,window.innerHeight);$this.deviceView=typeof window.orientation&&$.inArray(window.orientation,[0,-90])?0:1})};$.Cache=function(Key,Val,outTime){var timetamp=Math.round((new Date).getTime()/1e3);if(typeof Storage!=="undefined"){if(typeof Val==="string"&&!Val){localStorage.removeItem(Key);localStorage.removeItem(Key+"_jsjson");localStorage.removeItem(Key+"_Expired");return true}else if(typeof Val!=="undefined"){if(typeof Val==="object"){Val=JSON.stringify(Val);localStorage.setItem(Key+"_jsjson",1)}localStorage.setItem(Key,Val);outTime=parseInt(outTime);if(outTime){localStorage.setItem(Key+"_Expired",timetamp+outTime)}return $.Cache(Key)}else{var _Expired=localStorage.getItem(Key+"_Expired");if(_Expired&&_Expired<timetamp){return}Val=localStorage.getItem(Key);if(localStorage.getItem(Key+"_jsjson")=="1"){Val=JSON.parse(Val)}return Val}}};$.Position=function(centerObj,fellows){centerObj=$(centerObj);fellows=$(fellows);var offset={left:centerObj.offset().left,top:centerObj.offset().top+centerObj.height(true)};if(offset.left>this.W-fellows.width(true)){offset.left=offset.left-fellows.width(true)-centerObj.height(true)}if(offset.top>this.H-fellows.height(true)){offset.top=offset.top-fellows.height(true)-centerObj.height(true)}fellows.css(offset)};$.layerHideF=function(){if(!typeof window.parent){return}var id=$("body").attr("parentlayerid");if(id){window.parent.$.layerHide(id)}};$.layerHide=function(Id,Fun){$("body").removeClass("ks-body-layer-overflow");var o;if(!Id){return}o=$("#ks-layer-"+Id);if(!o.length){return}var option=LayerObject[Id]?LayerObject[Id].option:{};if(Id){var coverEle=o.next('[data-layer-key="'+Id+'"]');o.addClass("ks-anim-hide");coverEle.addClass("ks-anim-fadeout");if($.layerHideBackEvent===undefined||$.layerHideBackEvent){option.backEvent&&$.BackEvent("KsaLayer"+Id)}setTimeout(function(){o.active(false);Fun&&Fun(Id);!option.cancel&&option.close&&option.close();option.hide&&option.hide();if(option.cache){coverEle.length&&coverEle.hide();o.hide()}else{coverEle.length&&coverEle.remove();o.remove();delete LayerObject[Id]}},200)}};var LayerObject={};$.layer=function(option,pos,cover,showFun,closeFun,btnFun,initFun){var EL=$(option.el||"body");var ELoffset=EL.offset();var ELSize={W:EL.width(true),H:EL.height(true),L:ELoffset.left,T:ELoffset.top};var layerAnim={0:"ks-anim-up",1:"ks-anim-right",2:"ks-anim-down",3:"ks-anim-left",4:"ks-anim-right",5:"ks-anim-scale",6:"ks-anim-left",7:"ks-anim-right",8:"ks-anim-up",9:"ks-anim-left","00":"ks-anim-left"};var R={ID:1,layer:null,obj:{},isCache:false,autoCloseObj:null,init:function(){var _this=this;if(option.cache){$.loop(LayerObject,function(val){if(val.cache===option.cache){_this.obj=val;_this.isCache=true;_this.layer=$(_this.obj.dom)}})}_this.optionInit();!_this.isCache&&_this.createDom();_this.sizeInit();this.show();if(!_this.isCache&&option.ajaxUrl){$.API(option.ajaxUrl,option.ajaxPost,function(d){_this.layer.children(".ks-layer-content").html(d);option.ajaxCall&&option.ajaxCall.call(_this.layer,_this.layer.children(".ks-layer-content").children("*"));window.setTimeout(function(){_this.pos()})})}return this.obj},optionInit:function(){if(typeof option=="string"||option instanceof $&&option[0].innerHTML){option={content:option}}if(option.ajaxUrl){option.content='<div class="ks-loading"></div>'}option=$.arrayMerge({el:$.layerEL||"body",title:null,content:null,class:"",iframe:null,ajaxUrl:null,ajaxPost:null,type:"",pos:pos?pos:5,btn:null,btnFun:btnFun,cover:$.isset(cover)?cover:0,outTime:0,init:initFun,show:showFun,close:closeFun,closeBtn:1,backEvent:null,cache:null,maxHeight:0,height:null},option);if(option.backEvent===null&&$.isMobile){option.backEvent=1}option.type=option.type?option.class+" "+option.class+"_"+option.type:"";option.cache=option.cache?option.cache:null;if(option.iframe){option.class+=" ks-layer-iframe";option.content='<div class="ks-loading"></div><iframe src="'+option.iframe+'" width="100%" height="100%"></iframe>'}},pos:function(){var _this=this;var style={};var pos=option.pos;_this.countSize();var w=_this.obj.width,h=_this.obj.height;if($.inArray(pos,["00",1,2,3,4,5,6,7,8,9])){if($.inArray(pos,[1,4,7])){style.left=0}if($.inArray(pos,[1,2,3])){style.top=0}if($.inArray(pos,[2,5,8])){style["margin-left"]=$.intval(0-w/2)}if($.inArray(pos,[3,6,9])){style.right=0;style.left="initial"}if($.inArray(pos,[4,5,6])){style["margin-top"]=$.intval(0-h/2)}if($.inArray(pos,[7,8,9])){style.top="initial";style.bottom="0"}if(pos=="00"){style.top="0";style.bottom="0";style["margin-left"]="-100%"}}else{var trigger=$(pos),teiggerW=trigger.width(true),teiggerH=trigger.height(true),layerW=this.layer.width(true),layerH=this.layer.height(true);style.left=trigger.offset().left;style.top=trigger.offset().top+teiggerH;var seH=trigger.offset().top-$(document).scrollTop()+teiggerH+layerH;if(ELSize.W-(style.left+layerW)<0){style.left=style.left-layerW+teiggerW}if($.H-seH<0){style.top=trigger.offset().top-layerH;_this.obj.pos=2}else{_this.obj.pos=8}}this.layer.css(style)},close:function(){this.autoCloseObj&&clearTimeout(this.autoCloseObj);$.layerHide(this.ID)},createDom:function(){var _this=this;var id=$.ZINDEX++;var dom="";if(option.closeBtn){dom+='<span class="ks-layer-close" icon="close"></span>'}if(option.title){dom+='<div class="ks-layer-title">'+option.title+"</div>"}dom+='<div class="ks-layer-content"></div>';if(option.btn){var s="";if($.isString(option.btn)){s+=$.tag("ks-btn",{"data-btn-index":0},option.btn)}else{$.loop(option.btn,function(val,k){val=val.split(":");s+=$.tag("ks-btn",{class:"_"+k,"data-btn-index":k,color:val[1],cap:$.isMobile},val[0])})}dom+=s?'<div class="ks-layer-bottom">'+s+"</div>":""}var pos=$.isObject(option.pos)?0:option.pos;dom=$.tag("div",{class:"ks-layer "+option.class+" "+option.type,pos:pos,id:"ks-layer-"+id,style:"z-index:"+id,key:id},dom);dom=$(dom);dom.find(".ks-layer-content").html(option.content);LayerObject[id]=this.obj={dom:dom[0],coverDom:"",id:id,selector:"#ks-layer-"+id,option:option,width:0,height:0,cache:option.cache,pos:pos,resize:function(){_this.pos()},close:function(){_this.close()},show:function(){_this.show()}};_this.ID=id;_this.layer=dom;_this.layer.layerID=id;$(EL).append(dom);if(option.iframe){dom.iframe=null;dom.find("iframe")[0].onload=function(){dom.iframe=$(this.contentWindow.document.body);dom.iframe.attr("parentlayerid",id);dom.find(".ks-loading").remove()}}if(option.closeBtn){dom.find(".ks-layer-close").click(function(){_this.close()})}if(option.btn){dom.find(".ks-layer-bottom > ks-btn").click(function(){var t=$(this);if(!t.disabled()&&(!option.btnFun||typeof option.btnFun=="function"&&option.btnFun.call(_this,t.data("btn-index"),dom)!==false)){option.cancel=t.data("btn-index")==="cancel";_this.close()}}).filter("ks-btn:last-child:not([color])").attr("color","primary")}if(option.cover){var cover=$('<div class="ks-layer-cover" data-layer-key="'+id+'" style="z-index: '+(id-1)+'"></div>');_this.obj.coverDom=cover[0];cover.css($.arrayMerge({top:0,right:0,bottom:0,left:0},$.isObject(option.cover)?option.cover:{}));if(option.cover>1){var coverEvent=$.isMobile?"touchend":option.cover==3?"dblclick":option.cover==2?"click":"";coverEvent&&cover.on(coverEvent,function(){_this.close()})}_this.layer.after(cover)}dom.layer=_this;$.isFunction(option.init)&&option.init(dom,id)},sizeInit:function(){var style={};var cententMaxH=$.H;if(option.title){cententMaxH-=this.layer.children(".ks-layer-title").height(true,true)}if(option.btn){cententMaxH-=this.layer.children(".ks-layer-bottom").height(true,true)}if(option.height){style.height=option.height;if($.strpos(style.height,"%")){style.height=cententMaxH*$.floatval(style.height)/100}}if(option.maxHeight){style["max-height"]=option.maxHeight;if($.isString(style["max-height"])&&style["max-height"].indexOf("%")){style["max-height"]=cententMaxH*$.floatval(style["max-height"])/100}}if(option.width){style.width=option.width;if($.isString(style.width)&&style.width.indexOf("%")){style.width=$.floatval(style.width);style.width=ELSize.W*style.width/100}}this.layer.children(".ks-layer-content").css(style)},show:function(){var _this=this;var pos=_this.obj.pos,id=_this.ID;if(!$.isset(option.bodyOver)||option.bodyOver){$(EL).addClass("ks-body-layer-overflow")}this.layer.removeClass("ks-anim-hide").show();$(this.obj.coverDom).removeClass("ks-anim-fadeout").show();window.setTimeout(function(){layerAnim[pos]&&_this.layer.addClass(layerAnim[pos]);_this.layer.active(true);option.backEvent&&$.BackEvent("KsaLayer"+id,"#ks-layer-"+id);$.isFunction(option.show)&&option.show(_this.layer,id);if(option.outTime>0){_this.autoCloseObj=setTimeout(function(){_this.close()},option.outTime*1e3+50)}_this.pos();window.setTimeout(function(){_this.pos()},200)});$(document).off("keydown.ks-layer").on("keydown.ks-layer",function(e){if(e.keyCode==27){var o=$(".ks-layer").last();if(o.length){$.layerHide(o.attr("key"))}}});return _this.layer},countSize:function(){this.obj.width=this.layer.width(true);this.obj.height=this.layer.height(true)}};return R.init()};$.Dialog=function(type){var p=arguments;var op={class:"ks-Dialog ks-Dialog"};switch(true){case $.inArray(type,["success","error"]):op.content=p[1];op.close=p[2];op.btn=p[3]||{cancel:"知道了:primary"};op.class+="_"+type;op.closeBtn=0;op.cover=2;op.backEvent=false;break;case type=="confirm":var btn=p[4],callFun=p[3];btn=btn&&$.isString(btn)?{confirm:btn}:btn||{cancel:"取消",confirm:"确认:primary"};op.title=p[1];op.content=p[2];op.close=null;op.btn=btn;op.outTime=0;op.cover=1;op.maxWidth="80%";op.btnFun=function(a,layer){if(a=="confirm"&&typeof callFun=="function"){return callFun.apply(layer,[layer])}};op.class+="_"+type;op.closeBtn=0;break;case type=="prompt":var callFun=p[4];op.title=p[1];var tpes=["text","textarea","textarea","password"];var p6=p[5]||0;var ty=tpes[p6];var isArea=$.inArray(p6,[1,2]);if(isArea){op.content=$.tag(ty,{type:"ks-"+ty,placeholder:p[2],auto:p6==2},p[3])}else{op.content="";op.content+=$.tag("input",{type:"ks-"+ty,placeholder:p[2],value:p[3]},"",true);if(p6==3){op.content+=$.tag("input",{type:"ks-"+ty,placeholder:"再次输入新密码",class:"ks-mt3"},"",true);op.content+=$.tag("input",{type:"ks-"+ty,placeholder:"请输入旧密码",name:"old",value:"",class:"ks-mt3"},"",true)}}op.close=null;op.btn={cancel:"取消",confirm:"确认:primary"};op.outTime=0;op.cover=1;op.maxWidth="80%";op.btnFun=function(a,d){if(a=="confirm"&&typeof callFun=="function"){var inpt=d.find(isArea?"textarea":"input");var val=inpt.eq(0).val();val=val?val:"";if(p6==3){var in2val=inpt.eq(1).val();if(!val||!in2val||val!==in2val){$.toast("请输入密码，且两次须相同");return false}var oldval=inpt.eq(2).val();if(!oldval){$.toast("请输入旧密码");return false}return callFun.apply(this,[val,oldval,d])}return callFun.apply(this,[val,d])}};op.class+="_"+type;op.closeBtn=1;if($.isMobile){op.pos="8"}break;case type=="form":var H=$.createForm(p[2]);var submitConfirm=p[2].confirm;var callFun=p[3];op.title=p[1];op.content=H;op.close=null;op.btn={cancel:"取消",confirm:p[4]?p[4]:"确认"};op.outTime=0;op.cover=1;op.btnFun=function(a,layer){function callf(){if(p[2].action){layer.find("form").formSubmit(function(res,sdt){var callR;if(callFun){callR=callFun.apply(layer,arguments)}if(callR!==false&&sdt.success){$.layerHide(layer.layerID)}});return false}else{if(callFun){return callFun.apply(layer,[layer.find("form").formData(),layer])}}}if(a=="confirm"){if(submitConfirm){submitConfirm=submitConfirm===true?"确认要进行该操作吗？":submitConfirm;$.Dialog("confirm",submitConfirm,"",function(){callf();return true});return false}else{return callf()}}};op.class+="_"+type;op.closeBtn=1;op.maxHeight="100%";op.show=function(layer){layer.find("form").submit(function(e){e.stop()})};op.pos=5;if($.isMobile){op.pos=8;op.width="100%"}break;case type=="smscode":var param=p[2];op.title="请输入短信验证码";op.content="";if(p[1]){op.content+='<div class="ks-mb">'+p[1]+"</div>"}op.content+='<div><ks-input-group><input type="ks-text" name="code" value="" placeholder="请输入"><ks-btn>重新发送</ks-btn></ks-input-group></div>';var callData={};op.init=function(ly){var btn=ly.find(".ks-layer-content ks-btn");var input=ly.find("input[name=code]");var _send=function(){if(btn.disabled()){return}btn.disabled(true).text("发送中");$.API(param.api,param.post,function(res){if(res.success){input.val("");callData=res;var sendTime=res.sendTime;sendTime--;btn.disabled(true).text("重新发送("+sendTime+"秒)");ly.layer.pos();var s=window.setInterval(function(){if(sendTime===0){window.clearInterval(s);btn.disabled(false).text("重新发送");ly.layer.pos()}else{sendTime--;btn.disabled(true).text("重新发送("+sendTime+"秒)")}},1e3)}else{btn.disabled(false).text("重新发送")}},function(){btn.disabled(false).text("重新发送")})};btn.click(_send);_send()};var callFun=p[3];op.btn={cancel:"取消",confirm:"确认"};op.btnFun=function(a,ly){var input=ly.find("input[name=code]");if(a=="confirm"&&typeof callFun=="function"){callData.code=input.val()||"";if(!callData.code){$.toast("请输入短信验证码");return false}return callFun.call(ly,callData)}};op.cover=1;break;default:op.title=p[0];op.content=p[1];op.outTime=p[2];op.btn=p[3];op.btnFun=p[4];op.close=p[5];op.cover=1;op.pos=5;break}return $.layer(op)};$.toast=function(msg,tps,callFun,outTime){$.toastHide();var cover=0;outTime=typeof outTime=="undefined"?2:outTime;if(msg=="loading"){msg="数据加载中";callFun=tps;tps="loading";outTime=0;cover=1}if(tps){msg='<div icon="'+tps+'">'+msg+"</div>"}return $.layer({content:msg,class:"ks-Dialog_toast",type:tps,cover:cover,close:callFun,outTime:outTime,backEvent:false,bodyOver:false,cancel:false})};$.toastHide=function(){$(".ks-layer.ks-Dialog_toast + .ks-layer-cover").remove();$(".ks-layer.ks-Dialog_toast").remove()};$.openWindow=function(option){var h='<div class="ks-hdbar">';if(option.backBtn===null||option.backBtn!==false){h+='<span icon="back" onclick="window.history.go(-1);"></span>'}h+='<div class="ks-hdbar-title">'+option.title+"</div>";h+="</div>";return this.layer($.arrayMerge(option,{title:h,content:option.content||'<div class="layer-loading"><i icon="loading"></i>加载中</div>',width:"100%",height:"100%",maxHeight:false,pos:"00",class:"openWindow"}))};$.times=function(str,F){if($.isNumber(str)&&$.inArray($.strlen(str),[10,13])){if(str.length==10){str=str*1e3}str=parseInt(str)}if(typeof str=="string"){str=str.replace(/年|月/g,"-");str=str.replace(/时|分|点/g,":");str=str.replace(/日|秒/g,"")}var date=str?new Date(str):new Date;var obj={Y:date.getFullYear(),m:date.getMonth()+1,d:date.getDate(),H:date.getHours(),i:date.getMinutes(),s:date.getSeconds(),str:"",timestamp:date.getTime()};obj.str=obj.Y+"-"+obj.m+"-"+obj.d+" "+obj.H+":"+obj.i+":"+obj.s;$.loop(obj,function(val,k){obj[k]=val<10?"0"+val:val;F&&(F=F.replace(k,val))});return F?F:obj};$.days=function(y,m){return new Date(y,m,0).getDate()};$.week=function(y,m,d){var w=new Date(y+"-"+m+"-"+d).getDay();return w==0?7:w};$.API=function(url,postdata,fun,errfun,datatype,isBflow){datatype=datatype?datatype:"json";url=$.urlAdd(url,{ajax:1});fun=fun?fun:new Function;errfun=errfun?errfun:new Function;var option={type:postdata?"POST":"GET",url:url,dataType:datatype,data:postdata,success:function(s){if(s&&typeof s=="object"){if($.isset(s.result)){if(s.result.KSAUI){if(s.result.KSAUI.type=="Dialog"){s.result.KSAUI.param.push(function(s){return fun?fun(s):true});$.Dialog.apply("",s.result.KSAUI.param)}else{$[s.result.KSAUI.type].apply("",s.result.KSAUI.param)}}if($.isset(s.msg)&&s.msg){if(s.confirm){$.Dialog("confirm","提示信息",s.msg,function(){fun(s.result,s);if(s.success&&s.locationUrl){window.location.href=s.locationUrl}},"确认")}else{if(s.success){$.toast(s.msg,"success",function(){if(s.success&&s.locationUrl){window.location.href=s.locationUrl}})}else{$.toast(s.msg,"error")}fun(s.result,s)}}else{fun(s.result,s)}}else{console.log("%cKSAUI-AJAX-ERROR API异常返回！URL："+url+"\n","background:#f00; color:#fff",s);errfun(s)}}else{$.toast("error","ajax远端系统错误")}},error:function(s){console.log("%cKSAUI-AJAX-ERROR (Code:"+s.status+")","background:#f00; color:#fff","URL:"+url);$.toast("ajax远端系统错误","error");if(typeof errfun==="function"){errfun(s)}}};if(isBflow){option.processData=false;option.contentType=false}$.ajax(option);return false};$.ajaxWin=function(tit,url){return $.API(url,"",function(data){$.layer({title:tit,content:data,cover:1})})};$.plugin.formSubmit=function(callFun){var ths=this,obj=ths.eq(0);if(!obj.length){return false}var confirmTxt=obj.attr("confirm");if(confirmTxt===""){confirmTxt="确认要提交该信息吗？"}var loadingLayerID;var _submit=function(){var btn=obj.find("button[type=submit], input[type=submit], ks-btn[submit]");var btnTxt=btn.html();btn.addClass("btn-load").disabled(true).text(btnTxt);var formData=obj.formData(true);if(obj.attr("id")){formData.append("FORMID",obj.attr("id"))}loadingLayerID=$.toast("请稍后","","","",0).id;$.API($.urlAdd(obj.attr("action"),"formsubmit=true"),formData,function(dt,sdt){$.layerHide(loadingLayerID);btn.removeClass("btn-load").disabled(false).html(btnTxt);if(callFun&&callFun.apply(obj[0],arguments)===false){return false}if($.isObject(dt)&&sdt.success&&$("body").attr("parentlayerid")){$.layerHideF();window.parent.$.layerHide(loadingLayerID)}},function(){$.layerHide(loadingLayerID);btn.removeClass("btn-load").disabled(false).html(btnTxt)},"json",1);setTimeout(function(){btn.removeClass("btn-load").disabled(false).html(btnTxt);$.layerHide(loadingLayerID)},30*1e3)};if(confirmTxt){$.Dialog("confirm","操作提示",confirmTxt,_submit)}else{_submit()}return false};$.upload=function(name,files,url,callFun){name=name?name:"upload";var formData=new FormData;if(files instanceof Blob){formData.append(name,files)}else{files=files.files;if(files.length>1&&name.indexOf("[]")===-1){name+="[]"}$.loop(files,function(val){if(val.size&&val.type){formData.append(name,val)}})}this.API(url,formData,function(data){callFun(data)},null,"json",1)};$.tag=function(tp,dt,txt,ed){var h="<"+tp;$.loop(dt,function(v,k){v=v===undefined?null:v;v=v===true?k:v;h+=k&&v!=null?" "+k+'="'+v+'"':""});h+=">"+(txt?txt:"");if(!ed){h+="</"+tp+">"}return h};$.plugin.listSelect=function(callFun){var $this=this;var isMultiple=$.isset($this.attr("multiple"));$this.find("ks-list-item").click(function(e){if($this.disabled()){return}var T=$(this);if(T.hasClass("ks-select-optgroup-title")||T.disabled()){return false}if(isMultiple){if(T.selected()){T.selected(false)}else{T.selected(true)}}else{T.selected(true).siblings().selected(false)}var txtM={};$this.find("ks-list-item[selected]").each(function(_,l){l=$(l);txtM[l.attr("value")]=T.attr("_text")||T.attr("text")||T.text()});$.isFunction(callFun)&&callFun(T.attr("value"),T.attr("_text")||T.attr("text")||T.text(),txtM,T,e);return false});return this};$.selectToHtml=function(element,multiple){var data,defvalue,select,Nums=0;if($.isObjectPlain(element)){data=element;defvalue=element.value;multiple=$.isset(multiple)?multiple:element.multiple}else if($.isArray(element)){data=element}else{select=$(element);multiple=select.prop("multiple");defvalue=select.val();data=option2json(select)}function _isSelected(v){return $.isArray(defvalue)&&$.inArray(v,defvalue)||$.isObjectPlain(defvalue)&&$.isset(defvalue[v])||v===defvalue}function option2json(o){var n=0,dt=[];o.children().each(function(i,t){t=$(t);var attr=t.attr();var v={value:attr.value||"",title:attr.title||"",text:t.text()||"",showtitle:attr.showtitle||"",selected:_isSelected(attr.value)?true:"",disabled:t.disabled()||"",icon:attr.icon||"",style:attr.style||"",n:Nums};if(t[0].tagName=="OPTGROUP"){v.text=attr.label||"";v.option=option2json(t)}else{Nums++}dt[n]=v;n++});return dt}function options(dt){var h="";$.loop(dt,function(value,key){if(value.option){h+='<ks-list-item class="ks-select-optgroup-title"><strong>'+value.text+'</strong><ks-list class="ks-list-select" '+(multiple?' multiple="multiple"':"")+">"+options(value.option)+"</ks-list></ks-list-item>"}else{if(!$.isObject(value)&&!$.isArray(value)){value={value:key,text:value,selected:_isSelected(key)}}h+=$.tag("ks-list-item",{selected:value.selected?"selected":"",disabled:value.disabled,icon:value.icon,style:value.style,title:value.title,value:value.value,n:value.n,_text:value.showtitle||value.text},value.text)}});return h}return[select,multiple,'<ks-list class="ks-list-select" '+(multiple?' multiple="multiple"':"")+">"+options(data)+"</ks-list>"]};function select_json_html(dt,defvalue,multiple){var h="";var dtArr=$.isArray(dt);$.loop(dt.option,function(value,key){if(value.option){h+='<ks-list-item class="ks-select-optgroup-title"><strong>'+value.label+"</strong>"+select_json_html(value,defvalue,multiple)+"</ks-list-item>"}else{if(!$.isObject(value)){value={value:dtArr?value:key,label:value}}if(defvalue&&$.inArray(value.value,defvalue)){value.selected=true}if(!value.selected){value.selected=null}var txt=$.isset(value.label)?value.label:value.content;delete value.content;h+=$.tag("ks-list-item",value,txt)}});return'<ks-list class="ks-list-select" '+(multiple?' multiple="multiple"':"")+">"+h+"</ks-list>"}function select_html_json(select,defValue,Nums){Nums=Nums||0;select=$(select);defValue=Nums===0?select.val():defValue;var json=select.attr()||{};json.option=[];select.children().map(function(el){var v;if(el.tagName=="OPTGROUP"){v=select_html_json(el,defValue,Nums)}else{v=$(el).attr()||{};v.n=Nums;v.selected=!!el.selected;v.content=el.text;Nums++}json.option.push(v)});return json}$.plugin.showSelect=function(data,callFun,multiple,layerOption){var btn=$(this[0]),isBtnInput=this[0].tagName==="INPUT";if(btn.disabled()){return}var layerID=btn.data("layer-id");function _close(){layerID&&$.layerHide(layerID);btn.removeData("layer-id").active(false)}if(layerID){_close();return}multiple=data.multiple;if(isBtnInput&&!data.option){data={value:[btn.val()],option:data}}else if(!data.option){data={option:data}}data.value=data.value&&!$.isArray(data.value)?[data.value]:data.value;layerOption=layerOption||{};layerOption=$.arrayMerge({title:data.label?data.title||data.label:false,pos:$.isMobile?"8":btn,cover:$.isMobile?2:0,content:select_json_html(data,data.value,data.multiple),closeBtn:0,bodyOver:false,init:function(layer){if(!layer.layerID){return}layerID=layer.layerID;btn.data("layer-id",layerID).active(true);var d=layer.find(".ks-layer-content");if(d.find("ks-list-item[selected]").length){d.scrollTop(d.find("ks-list-item[selected]").eq(0).offset().top-d.offset().top-d.find("ks-list-item").eq(0).height())}$(d.find(".ks-list-select")).listSelect(function(val,txt,valdt,T,e){e.stopPropagation();if(multiple){txt="";d.find("ks-list-item[selected]").each(function(i,l){txt+="<span>"+l.innerHTML+"</span>"});txt=txt?txt:"请选择"}isBtnInput&&btn.val(txt);callFun&&callFun.call(T,val,txt,valdt,T,e);if(!multiple){_close()}})},show:function(layer){layerID=layer.layerID;if(!$.isMobile){$(document).on("click.KSAUI-select",function(e){if(!$.inArray(e.target,[btn[0],layer[0]])){$(document).off("click.KSAUI-select");_close()}})}},hide:_close},layerOption,{class:"ks-layer-select"});var Lay=$.layer(layerOption);layerID=Lay.id;return Lay};$.showDate=function(target,format,callFun){var $this=this;target=$(target);var input=target[0]&&target[0].tagName=="INPUT"?target:null;if(target.data("layer-id")){$.layerHide(target.data("layer-id"));return}format=format?format:target.attr("format")||"Y-m-d H:i";var defYmd=input?input.val():target.attr("value");var cl={a:"ks-calendar",b:"ks-calendar-t",c:"ks-calendar-ul",d:"ks-calendar-b",e:"ks-calendar-time"};var isy=format.indexOf("Y")!=-1,ismd=format.indexOf("m")!=-1&&format.indexOf("d")!=-1,isymd=isy&&ismd,isHi=format.indexOf("H")!=-1&&format.indexOf("i")!=-1,isHis=isHi&&format.indexOf("s")!=-1;function monthHtml(str){str=str&&!ismd?defYmd+" "+str:str;var dt=$this.times(str);if(!dt.Y||!dt.m){return}var Html="",ly=dt.Y,lm=parseInt(dt.m)-1;if(lm<1){lm=12;ly--}var lastDay=$this.days(ly,lm),week=$this.week(ly,lm,lastDay);Html+="<em>一</em><em>二</em><em>三</em><em>四</em><em>五</em><em>六</em><em>日</em>";var u=0;for(var i=lastDay-week+1;i<=lastDay;i++){Html+='<i class="_" data-value="'+ly+"-"+lm+"-"+i+'">'+i+"</i>";u++}for(var i=1;i<=$this.days(dt.Y,dt.m);i++){Html+='<i class="'+(i==dt.d?" a":"")+'" data-value="'+dt.Y+"-"+dt.m+"-"+i+'">'+i+"</i>";u++}u=42-u;if(u>0){var ny=dt.Y,nm=dt.m;nm++;if(nm>12){nm=1;ny++}for(i=1;i<=u;i++){Html+='<i class="_" data-value="'+ny+"-"+nm+"-"+i+'">'+i+"</i>"}}dt.html=Html;return dt}var dt=monthHtml(defYmd);var TimeHtml="";if(isHi){TimeHtml='<div class="'+cl.d+' ks-clear">';TimeHtml+='<div class="'+cl.e+'">';TimeHtml+='<div><input type="ks-number" value="'+dt.H+'" min="0" max="23"></div>';TimeHtml+="<div>:</div>";TimeHtml+='<div><input type="ks-number" value="'+dt.i+'" min="0" max="59"></div>';if(isHis){TimeHtml+="<div>:</div>";TimeHtml+='<div><input type="ks-number" value="'+dt.s+'" min="0" max="59"></div>'}TimeHtml+="</div>";TimeHtml+='<ks-btn color="primary">确认</ks-btn>';TimeHtml+="</div>"}var H='<div class="'+cl.a+'" data-y="'+dt.Y+'" data-m="'+dt.m+'" data-d="'+dt.d+'">';if(isymd){H+='<div class="'+cl.b+'"><i icon="arrow-left-s-fill"></i><i icon="arrow-left-s"></i><em>'+dt.Y+"年</em><em>"+dt.m+'月</em><i icon="arrow-right-s"></i><i icon="arrow-right-s-fill"></i></div><div class="'+cl.c+'">'+dt.html+"</div>"}H+=TimeHtml;H+="</div>";$.layer({cover:!!$.isMobile,pos:$.isMobile?8:target,width:$.isMobile?"100%":null,content:H,closeBtn:0,bodyOver:false,show:function(layer){target.data("layer-id",layer.layerID);var dom=layer.find("."+cl.a);layer.click(function(e){e.stopPropagation();return false});if($.isMobile){layer.find(".ks-layer-content").css("padding","0");layer.find(".ks-calendar").css("width","100%")}function sput(){var v=defYmd;if(format.indexOf("m")!=-1){v=dom.find("."+cl.c+" i.a").data("value")}if(isHi){var b=dom.find("."+cl.e+" input");if(b.length){v+=" "+b.eq(0).val()+":"+b.eq(1).val();if(isHis){v+=":"+b.eq(2).val()}}}var h=$this.times(v);v=format.replace("Y",h.Y).replace("m",h.m).replace("d",h.d).replace("H",h.H).replace("i",h.i).replace("s",h.s);if(input){input.val(v);input.trigger("input").trigger("change")}target.attr("value",v);callFun&&callFun(v);return v}function ulevent(){dom.find("."+cl.c+" i").click(function(){$(this).addClass("a").siblings().removeClass("a");!isHi&&sput();if(!dom.find("."+cl.d).length){$.layerHide(layer.layerID)}return false})}ulevent();dom.find("."+cl.b+" i").click(function(){var N=$(this).index();var y=parseInt(dom.data("y")),m=parseInt(dom.data("m")),d=parseInt(dom.data("d"));if(N==0){y--}else if(N==5){y++}else if(N==1){m--;if(m<1){m=12;y--}}else if(N==4){m++;if(m>12){m=1;y++}}dom.data({y:y,m:m});var em=$(this).siblings("em");em.eq(0).text(y+"年");em.eq(1).text(m+"月");dom.find("."+cl.c).html(monthHtml(y+"-"+m+"-"+d).html);ulevent();return false});dom.find("ks-btn").click(function(){sput();$.layerHide(layer.layerID);return false});layer.hover(function(){target.attr("ks-date-show",1)},function(){target.removeAttr("ks-date-show")});input&&input.blur(function(){!$(this).attr("ks-date-show")&&$.layerHide(layer.layerID)});$(document).on("click.KSAUI-showdate",function(e){if(!$.inArray(e.target,[target[0],layer[0]])){$(document).off("click.KSAUI-showdate");$.layerHide(layer.layerID)}})},close:function(){target.removeData("layer-id")}})};$.plugin.showMenu=function(action,options){var btns=this;function _funShow(){if(btns.active()){return}btns.active(true);$.layer({pos:btns,cover:0,content:content,closeBtn:0,bodyOver:false,init:function(layer){layer.addClass("ks-layer-showmenu");if(action==="hover"){var layerCloseEvn;btns.push(layer).hover(function(){layerCloseEvn&&window.clearTimeout(layerCloseEvn)},function(){layerCloseEvn=window.setTimeout(function(){$.layerHide(layer.layerID)},100)})}},show:function(layer){if(action!=="hover"){$(document).on("click.KSAUI-dropdown",function(e){if(e.target!==layer[0]){$.layerHide(layer.layerID);$(document).off("click.KSAUI-dropdown")}})}},close:function(){btns.active(false)}})}var isHtml=$.isString(options);var content="";if(isHtml){content=options}else{content="";$.loop(options,function(val,key){if($.isString(val)){content+=val}else{content+=$.tag(val.url?"a":"p",{style:val.style,href:val.url,icon:val.icon,"dropdown-event-key":key},val.label)}});content=$(content);content.filter("[dropdown-event-key]").map(function(ele){ele=$(ele);var key=ele.attr("dropdown-event-key");var op=options[key];if(op){op.event&&ele.click(op.event)}})}this.on(action==="hover"?"mouseenter":action,_funShow)};$.plugin.area=function(tit,defDt,callFun,maxLevel,apiUrl){var btn=$(this[0]);var layerID=0;if(btn.data("layer-id")){layerID=btn.data("layer-id");_close();return}tit=tit?tit:"设置地区信息";var _APIurl=apiUrl?apiUrl:"common/area";maxLevel=maxLevel>=0&&maxLevel<4?maxLevel:4;var Ts=["选择省份/地区","选择城市","选择区/县","选择城镇","选择街道"];var Fk=["province","city","area","town"];var level=0;var Dom;function _close(layerID){$.layerHide(layerID);btn.removeData("layer-id").active(false)}function __callDt(currID,end){var dt={current:{},data:{},isEnd:end?1:0};Dom.find(".ks-area-layer-btn p").each(function(i,ele){ele=$(ele);var f=ele.attr("field");if(ele.attr("val")){var v={id:ele.attr("val"),name:ele.text(),level:i,field:f};if(currID&&currID==ele.attr("val")){dt.current=v}dt.data[f]=v}});$.isFunction(callFun)&&callFun(dt)}function g(upID,currID){upID=upID?upID:"";$.API(_APIurl,{id:upID,level:level},function(data){var H="";$.loop(data,function(val){H+=$.tag("ks-list-item",{upid:upID,val:val.id,selected:currID&&currID==val.id?"selected":null},val.name)});if(!H){$.layerHide(layerID);btn.removeData("layer-id").active(false)}else{H='<ks-list class="ks-list-select">'+H+"</ks-list>";Dom.find(".ks-area-layer-c").html(H);(function(){var h=Dom.height(true);var o=Dom.find(".ks-area-layer-c");o.height(h-Dom.find(".ks-area-layer-btn").height(true));var p=o.find("ks-list-item[selected]");if(p.length){o.scrollTop(p.index()*p.height(true))}else{o.scrollTop(0)}})();Dom.find(".ks-list-select").listSelect(function(val,txt,valdata,t,e){var id=t.attr("val");t.selected(true).siblings().removeAttr("selected");var bt=Dom.find(".ks-area-layer-btn").find("p").eq(level);bt.text(txt).attr({upid:t.attr("upid"),val:id,field:Fk[level]}).show();bt.next().attr("upid",id).html('<span class="ks-text-gray">'+Ts[level+1]+"</span>").show();if(level==maxLevel-1){$.layerHide(layerID);btn.removeData("layer-id").active(true);__callDt(id,1)}else if(level<maxLevel){g(id);level++;__callDt(id)}})}})}$.layer({pos:$.isMobile?8:btn,cover:$.isMobile?2:0,width:$.isMobile?"100%":"",height:$.isMobile?"75%":"",class:"ks-area-layer",content:'<div class="ks-area-layer-btn"><p><span class="ks-text-gray">'+Ts[0]+'</span></p><p></p><p></p><p></p></div><div class="ks-area-layer-c">请稍后...</div>',closeBtn:false,bodyOver:false,init:function(layer,id){Dom=layer;layerID=id;btn.data("layer-id",id).active(true);layer.click(function(){return false});if(defDt){var p=layer.find(".ks-area-layer-btn p");var defEnd={};var upid=0;$.loop(defDt,function(val,k){upid=k>0?defDt[k-1].id:0;p.eq(val.level).text(val.name).attr({upid:upid,val:val.id,field:val.field}).show();if(level<val.level){level=val.level;defEnd=val}});g(upid,defEnd.id)}else{g()}layer.find(".ks-area-layer-btn p").click(function(){var t=$(this);level=t.index();t.nextAll().text("").removeClass("a").attr("upid","").attr("val","").hide();g(t.attr("upid"),t.attr("val"));__callDt(t.attr("val"))})},show:function(layer){$(document).on("click.KSAUI-area",function(e){if(!$.inArray(e.target,[btn[0],layer[0],layer.next('[data-layer-key="'+layer.layerID+'"]')[0]])){$(document).off("click.KSAUI-area");$.layerHide(layer.layerID);btn.removeData("layer-id").active(false)}})}})};$.showTip=function(obj,txt,click){obj=$(obj);txt=txt?txt:obj.attr("title")||"";if(!txt){return}$.ZINDEX++;$("body").append('<div class="ks-ftip" style="z-index:'+this.ZINDEX+'">'+txt+'<span class="ks-ftip-x"></span></div>');var tip=$(".ks-ftip");tip.show();var ht=tip.height(true)+tip.find(".ks-ftip-x").height(true)/2;var left=Math.min(obj.offset().left-10,window.innerWidth-tip.width(true)-10);tip.find(".ks-ftip-x").css({left:obj.offset().left-left+5});tip.css({left:left,top:obj.offset().top-ht});var s;obj.hover(function(){s&&clearTimeout(s)},function(){s=setTimeout(function(){tip.remove()},10)});tip.hover(function(){s&&clearTimeout(s)},function(){s=setTimeout(function(){tip.remove()},10)})};$.plugin.slide=function(options){options={auto:$.isset(options.auto)?$.floatval(options.auto===""?5:options.auto):5,card:$.isset(options.card),control:$.isset(options.control),status:$.isset(options.status)};options.auto=options.auto?$.floatval(options.auto)*1e3:0;this.map(function(ele){if(ele._KSAUI_slideRender){return}ele._KSAUI_slideRender=true;_Run(ele)});function _Run(ele){ele=$(ele);ele.children(".ks-slide-c").height(ele.height(true));var E={id:$.objectID(ele[0]),width:ele.width(true),height:ele.height(true),item:ele.find(".ks-slide-item"),itemC:"",MX:0,num:0,playIndex:0,init:function(){var ths=this;ths.num=this.item.length-1;var widthC=0;ths.item.each(function(_,e){e=$(e);var mw=e.width(true,true);var w=e.width(true);e.data("width",w).width(w);widthC+=mw});var newDom=$('<div class="ks-slide-c" style="width:'+(widthC+10)+'px; height:100%"></div>');newDom.html(this.item);ele.html(newDom);ths.itemC=newDom;var h="";if(options.control){h+='<div class="ks-slide-control-prev" icon="arrow-left-s"></div><div class="ks-slide-control-next" icon="arrow-right-s"></div>'}if(options.status){h+='<div class="ks-slide-status">';$.loop(ths.num+1,function(){h+="<span></span>"});h+="</div>"}if(options.progress){h+='<div class="ks-slide-progress"><span '+(options.progress!=1?' class="ks-bg-'+options.progress.trim()+'"':"")+"></span></div>"}if(h){ele.append(h)}if(options.control){ele.find(".ks-slide-control-prev").click(function(){E.play("prev")});ele.find(".ks-slide-control-next").click(function(){E.play("next")})}if(options.status){ele.find(".ks-slide-status span").click(function(){var v=$(this).index();if(v==ths.playIndex){return}var tp="next";if(v<ths.playIndex){tp="prev"}ths.play(tp,v);$(this).addClass("a").siblings().removeClass("a")})}ths.playIndex=ths.num;ths.play("next",0);var slideC=ths.itemC;ele.touch(function(){slideC.addClass("_a")},function(evn,touch){if(touch.action==="left"||touch.action==="right"){slideC.css({transform:"translateX("+(touch.moveX+ths.MX)+"px) scale(1)"})}},function(evn,touch){slideC.removeClass("_a");if(touch.action==="right"&&ths.playIndex<=0||touch.action==="left"&&ths.playIndex>=ths.num){ths.move(ths.playIndex);return}if(touch.action=="left"){E.play("next")}else if(touch.action=="right"){E.play("prev")}},"X")},move:function(i){var mX=0-this.item.eq(i).data("width")*i;this.itemC.css({transform:"translateX("+mX+"px) scale(1)"}).attr("index",i);this.MX=mX},play:function(tp,index){var ths=this;if($.isset(index)){index=parseInt(index)}else{index=ths.playIndex;if(tp=="prev"){index--}else if(tp=="next"){index++}}index=index<0?0:index>ths.num?0:index;ele.attr({playerindex:index,playeraction:tp});ths.move(index);ths.playIndex=index;if(options.auto){$.setTimeout("ksauiSlide"+ths.id,function(){ths.play(tp)},options.auto)}options.status&&ele.find(".ks-slide-status span").removeClass("a").eq(index).addClass("a")}};E.init()}return this};$.plugin.announcement=function(Timer,subTag,granTag){Timer=Timer>0?Timer:10;subTag=subTag?subTag:"ul";granTag=granTag?granTag:"li";this.each(function(){var ann=$(this);ann.addClass("ks-transition");var h=ann.height(true);var len=ann.find(granTag).length;var start=0;var S;function _run(){S=window.setInterval(function(){start++;if(start==len){start=0}ann.find(subTag).css("margin-top",0-start*h)},Timer*1e3)}_run();ann.hover(function(){window.clearInterval(S)},function(){_run()})});return this};$.createForm=function(option){option=$.isArray(option)?{action:"",field:option}:option;var H=$.tag("form",{action:option.action,class:option.class},"",true);H+="<ks-form>";$.loop(option.field,function(value,key){if(value&&$.isObject(value)){value.value=value.value?value.value:"";value.name=value.name?value.name:key;value.placeholder=value.placeholder?value.placeholder:"请输入...";value.style=value.style?' style="'+value.style+'"':"";if(value.type==="hidden"){H+=$.tag("input",{type:"hidden",name:value.name,value:value.value},"",true)}else{H+=$.tag("ks-form-item",{label:value.label,required:value.required,extra:value.extra},"",true);if(value.after||value.before){H+="<ks-input-group>";H+=value.before?value.before:""}if($.inArray(value.type,["number","text","password","tel","color"])){value.type=!value.unit?"ks-"+value.type:value.type;delete value.label;if(value.unit){H+="<ks-input-group>"}H+=$.tag("input",value,"",1);if(value.unit){H+="<i>"+value.unit+"</i>";H+="</ks-input-group>"}}else if($.inArray(value.type,["textarea"])){value.type="ks-"+value.type;var v=value.value;delete value.value;H+=$.tag("textarea",value,v)}else if(value.type=="switch"){value.value=value.value?value.value:"";H+=$.tag("input",{type:"ks-switch",name:value.name,value:value.value,text:value.text?value.text:"是",style:value.style,checked:value.value==1?" checked":null},"",1)}else if(value.type=="radio"){$.loop(value.option,function(v,k){H+=$.tag("input",{type:"ks-radio",name:value.name,value:k,text:v,checked:value.value==k?" checked":null,style:value.style},"",1)})}else if(value.type=="checkbox"){(function(){function check_x(checklist){var ch="";$.loop(checklist,function(v,k){if($.isObject(v)){ch+='<div class="ks-mb2"><p class="ks-fw3 ks-mb1">'+k+"</p>";ch+="<p>";ch+=check_x(v);ch+="</p></div>"}else{ch+=" "+$.tag("input",{type:"ks-checkbox",name:value.name+"[]",value:k,text:v,checked:value.value==k||$.inArray(k,value.value)?" checked":null,style:value.style},"",1)}});return ch}H+=check_x(value.option)})()}else if(value.type=="select"){var opth="";$.loop(value.option,function(v,k){if($.isObject(v)){k=v.id;v=v.value}opth+=$.tag("option",{value:k},v)});value.type="ks-"+value.type;delete value.option;H+=$.tag("select",value,opth)}else if(value.type=="date"){H+=$.tag("input",{type:"ks-date",name:value.name,value:value.value,title:value.title,placeholder:value.placeholder,style:value.style,format:value.format},"",1)}else if(value.type=="area"){H+=$.tag("ks-area",{province:value.value.province,city:value.value.city,area:value.value.area,town:value.value.town,maxlevel:value.value.maxlevel?maxlevel:4},"请选择");if($.isset(value.value.address)){H+='<input type="text" name="address"  value="'+value.value.address+'" placeholder="请输入街道地址" class="ks-input ks-mt1">'}}else if($.inArray(value.type,["pic","file"])){value.type="ks-"+value.type;H+=$.tag("input",value,"",1)}else{H+=value.value}if(value.after||value.before){H+=value.after?value.after:"";H+="</ks-input-group>"}H+="</ks-form-item>"}}else if(value&&$.isString(value)){H+="<ks-form-title>"+value+"</ks-form-title>"}});H+="</ks-form></form>";return H};$.imgZoom=function(file,maxWidth,maxHeight,callFun){file=file.files[0];var reader=new FileReader;reader.readAsDataURL(file);var img=new Image;reader.onload=function(e){img.src=e.target.result};img.onload=function(e){var canvas=document.createElement("canvas");var context=canvas.getContext("2d");var originWidth=this.width,originHeight=this.height,width=originWidth,height=originHeight;if(originWidth>maxWidth||originHeight>maxHeight){if(originWidth/originHeight>1){width=maxWidth;height=Math.round(maxWidth*(originHeight/originWidth))}else{height=maxHeight;width=Math.round(maxHeight*(originWidth/originHeight))}}canvas.width=width;canvas.height=height;context.clearRect(0,0,width,height);context.drawImage(img,0,0,width,height);canvas.toBlob(function(blob){blob=new File([blob],file.name,file);callFun&&callFun(blob)},file.type,1)}};function ks_input_group(ele){ele=$(ele);var attr=ele.attr();var dom=$(ele).wrap($.tag("ks-input-group",{class:attr.class,id:attr.id}));if(attr.icon){ele.before("<i>"+attr.icon+"</i>")}if(attr.label){ele.before("<i>"+attr.label+"</i>")}if(attr.unit){ele.after("<i>"+attr.unit+"</i>")}ele.attr({class:"",id:"",icon:""});return dom}(function(){$.render('select.ks-select, select[type="ks-select"], select[ks-render-type="select"]',function(ele,isAttrUp,update){let t=$(ele),at=t.attr();if(t[0].tagName!="SELECT"){return}if(!isAttrUp){t.removeClass("ks-select").attr({type:"","ks-render-type":"select"});if(!$.isset(at.value)&&at["data-value"]){at.value=at["data-value"]}$.isset(at.value)&&t.val(at.value)}if($.isset(at.open)){if(isAttrUp){t.next().disabled(t.disabled())}else{var json=select_html_json(t[0]);let selectList=$('<div class="ks-select-list">'+select_json_html(json,json.value,json.multiple)+"</div>");selectList.children().listSelect(function(value){$(t).val(Object.keys(arguments[2])).trigger("change")});t.after(selectList).hide();selectList.prepend(t);t.next().disabled(t.disabled());t.DOMchange("val",function(){var val=$(this).val();selectList.find("ks-list-item").selected(false);val=!$.isArray(val)?[val]:val;$.loop(val,function(v){selectList.find('ks-list-item[value="'+v+'"]').selected(true)})})}}else{function _selectText(){var text="";t.find("option:selected").each(function(_,e){text+=e.text?"<span>"+e.text+"</span>":""});return text?text:t.attr("deftext")||"请选择"}if(isAttrUp){t.parent().children(".ks-select-title").html(_selectText())}else{t.wrap($.tag("div",{class:"ks-select",style:at.style}));t.after('<span class="ks-select-title">'+_selectText()+"</span>");t.next().click(function(){if(t.disabled()){return}var optionJson=select_html_json(t[0]);$(this).showSelect(optionJson,function(val,txt,valdt){t.val(Object.keys(valdt)).attr("value",val)})});t.DOMchange("val",function(){t.next(".ks-select-title").html(_selectText());t.trigger("change")})}}},"attr.value attr.data-value attr.disabled");$.render('input[type="ks-radio"]',function(ele){var t=$(ele),at=t.attr();var txt=at.text?"<em>"+at.text+"</em>":"";t.attr({type:"radio"});t.wrap($.tag("label",{type:"radio",class:"ks-radio",icon:at.icon,style:at.style,color:at.color}));t.after("<i>"+txt+"</i>");t.change(function(){$(this).trigger("KSADOMchange",["attr.checked",this.checked])})});$.render('input[type="ks-checkbox"]',function(ele){var t=$(ele),at=t.attr();var txt=at.text?"<em>"+at.text+"</em>":"";t.attr({type:"checkbox"});t.wrap($.tag("label",{type:"checkbox",class:"ks-checkbox",icon:at.icon,style:at.style,color:at.color}));t.after("<i>"+txt+"</i>");var area=t.parent().parent();if(area.length&&area.attr("max")){var max=parseInt(area.attr("max"))||0;if(max>0){t.change(function(){var uN='input[type="checkbox"][name="'+t.attr("name")+'"]';if(area.find(uN+":checked").length==max&&t.checked()){area.find(uN+":not(:checked)").disabled(true)}else{area.find(uN+":not(:checked)").disabled(false)}})}}t.DOMchange("attr.checked",function(){$(this).trigger("change")})});$.render('input[type="ks-checkbox-all"]',function(ele){var t=$(ele),at=t.attr();var txt=at.text?"<em>"+at.text+"</em>":"";t.attr({type:"checkbox",ischeckall:1});t.wrap($.tag("label",{type:"checkbox",class:"ks-checkbox",icon:at.icon,style:at.style,color:at.color}));t.after("<i>"+txt+"</i>");var name=t.attr("name");if(!name){return this}var selector=$(t.attr("selector")||t.parent()[0].form||t.parent().parent());var tParent=t.parent();var inputs='input[type="checkbox"][name="'+name+'"]:not([ischeckall])';var indeterName="ks-checkbox-indeter";t.change(function(){selector.find(inputs).checked(this.checked)}).DOMchange("attr.checked",function(){selector.find(inputs).checked(this.checked)});t.on("changeALL",function(){var st=false;var selectedNum=selector.find(inputs+":checked").length;if(selectedNum>=selector.find(inputs).length){st=true;tParent.removeClass(indeterName)}else if(selectedNum>0){st=false;tParent.addClass(indeterName)}else if(!selectedNum){st=false;tParent.removeClass(indeterName)}t[0].checked=st});selector.on("change",inputs,function(){t.trigger("changeALL")})});$.render('input[type="ks-switch"]',function(ele){var t=$(ele),at=t.attr();var val=t.checked()?1:0,txt=at.text||"",name=at.name?' name="'+at.name+'"':"";if(txt){txt=txt.split("|");txt=$.isset(txt[1])?"<em>"+txt[1]+"</em><em>"+txt[0]+"</em>":"<em>"+txt[0]+"</em>"}t.attr("type","checkbox").removeAttr("name");t.wrap($.tag("label",{type:"switch",class:"ks-switch",icon:at.icon,style:at.style,color:at.color}));t.after("<i>"+txt+'</i><input type="hidden" '+name+' value="'+val+'">');t.change(function(){var cked=this.checked;$(this).trigger("KSADOMchange",["attr.checked",cked]).nextAll("input[type=hidden]").val(cked?1:0)})});$.render('input[type="ks-number"]',function(ele){ele=$(ele);var at=ele.attr();ele.attr("type","number").addClass("ks-input");ele.wrap($.tag("span",{type:"number",class:"ks-input ks-input-arrow",icon:at.icon,style:at.style}));ele.after('<span data-digit="down" icon="subtract"></span><span data-digit="up" icon="add"></span>');var attrs=ele.attr();!ele.val().length&&!attrs.placeholder&&ele.val(attrs.min||0);var ef=ele.parent();!ef.hasClass("ks-input-arrow")&&ef.addClass("ks-input-arrow");var min=$.floatval(attrs.min)||0,max=$.floatval(attrs.max)||0,step=$.floatval(attrs.step)||0,n=step&&step.toString().indexOf(".")!=-1?step.toString().split(".")[1].length:0;function r(x){var v=ele.val();var isZ=v.length>1&&v.substr(0,1)==="0";v=$.floatval(v)||0;if(x=="up"){if(step){v=v+step}else{v++}}else{if(step){v=v-step}else{v--}}v=n>0?v.toFixed(n):v;v=v<min?min:v;v=max&&v>max?max:v;v=v<=9&&isZ?"0"+v:v;ele.val(v)}var S,S1;var evn=$.isMobile?"touchstart touchend":"mousedown mouseup";ef.find("*[data-digit]").on(evn,function(e){var i=$(this).data("digit");if($.inArray(e.type,["mousedown","touchstart"])){r(i);S=setTimeout(function(){S1=setInterval(function(){r(i)},60)},250)}else{ele.change();clearInterval(S1);clearTimeout(S)}})});$.render('input[type="ks-date"]',function(ele){var t=$(ele),at=t.attr();t.attr("type","text");t.wrap($.tag("span",{type:"date",class:"ks-input",icon:at.icon,style:at.style}));if(!at.icon&&!at.iconleft&&!at.iconright){at.iconright="calendar"}(at.icon||at.iconleft)&&t.before('<left icon="'+(at.icon||at.iconleft)+'"></left>');at.iconright&&t.before('<right icon="'+at.iconright+'"></right>');$.isMobile&&t.after('<i class="ks-input-cover"></i>');t.parent().click(function(){$.showDate(t)})});$.render('input[type="ks-color"]',function(ele){var t=$(ele),at=t.attr();t.attr("type",at.type.substr(3));if(at.label){ks_input_group(t)}else{t.wrap($.tag("label",{type:"color",class:"ks-input-color",icon:at.icon,style:at.style}))}});$.render('input[type="ks-text"], input[type="ks-tel"]',function(ele){var t=$(ele),at=t.attr();t.attr("type",at.type.substr(3));if(at.label||at.unit){ks_input_group(t)}else{t.wrap($.tag("label",{type:"text",class:"ks-input",icon:at.icon,style:at.style}))}(at.icon||at.iconleft)&&t.before('<left icon="'+(at.icon||at.iconleft)+'"></left>');at.iconright&&t.before('<right icon="'+at.iconright+'"></right>');if($.isset(at.clear)){var clearbtn=$('<right class="ks-input-clear" icon="close-circle-fill" style="z-index:99"></right>');t.before(clearbtn);clearbtn.click(function(){t.val("").focus();clearbtn.active(false)});t.keyup(function(){if(t.val().length>0){clearbtn.active(true)}else{clearbtn.active(false)}});t.parent().hover(function(){$(this).find("input[type=text]").val().length>0&&clearbtn.active(true)},function(){window.setTimeout(function(){clearbtn.active(false)},10)})}if(at.api){var intxtS;var intxtLayerID;t.blur(function(){intxtLayerID&&$.layerHide(intxtLayerID);intxtS&&window.clearTimeout(intxtS)}).on("input focus",function(){var inputVal=$(this).val();intxtLayerID&&$.layerHide(intxtLayerID);intxtS&&window.clearTimeout(intxtS);if(inputVal.length>0){intxtS=window.setTimeout(function(){$.layer({pos:t,cover:0,content:"请稍后...",closeBtn:0,bodyOver:false,init:function(layer){intxtLayerID=layer.layerID;$.API(at.api,{keyword:inputVal},function(res){var h='<div class="ks-input-smart">';$.loop(res.list,function(val){h+='<p value="'+val.value+'">'+val.title+"</p>"});h+="</div>";h=$(h);h.find("p").click(function(){t.val($(this).text());$.layerHide(intxtLayerID)});layer.find(".ks-layer-content").html(h)})}})},300)}})}});$.render('input[type="ks-password"]',function(ele){var t=$(ele),at=t.attr();t.attr("type","password");t.wrap($.tag("span",{type:"password",class:"ks-input ks-password",style:at.style})).removeAttr("icon");(at.icon||at.iconleft)&&t.before('<left icon="'+(at.icon||at.iconleft)+'"></left>');at.iconright&&t.before('<right icon="'+at.iconright+'"></right>');if(t.active()){t.before('<right icon="eye-off" active></right>');t.prevAll("right[active]").click(function(){var ths=$(this);var input=ths.nextAll("input");if(input.attr("type")=="text"){input.attr("type","password");ths.addClass("ri-eye-off").removeClass("ri-eye-fill")}else{input.attr("type","text");ths.addClass("ri-eye-fill").removeClass("ri-eye-off")}})}});$.render('textarea[type="ks-textarea"]',function(ele){var t=$(ele),at=t.attr();t.removeAttr("type");t.wrap($.tag("ks-textarea",{class:"ks-textarea"}));var maxlength=parseInt(t.attr("maxlength"));if(maxlength){t.after('<div class="ks-textarea-maxtit"> <span>'+t.val().length+"</span>/"+maxlength+"</div>");t.keyup(function(){var n=t.val().length;if(n>maxlength){t.val(t.val().substr(0,maxlength))}t.next(".ks-textarea-maxtit").children("span").text(t.val().length)})}if($.isset(at.auto)){t.height(t[0].scrollHeight);t.input(function(){t.height(0);t.height(t[0].scrollHeight)})}});$.render('input[type="ks-area"]',function(t){var Fd=["province","city","area","town"];t=$(t);t.attr({type:"hidden",name:""}).wrap("<ks-area "+(t.disabled()?"disabled":"")+"></ks-area>");var attrs=t.attr();var maxlevel=0;var h="";var name=attrs.name;$.loop(Fd,function(val,k){var v=attrs[val];var tname=name?name+"["+val+"]":val;if(v){v=v.split(":");h+='<span level="'+k+'">'+'<input type="hidden" name="'+tname+'[id]" value="'+v[0]+'">'+'<input type="hidden" name="'+tname+'[name]" value="'+v[1]+'">'+v[1]+"</span>"}if($.isset(v)){maxlevel++}});t.after(h);t.parent().click(function(){var obj=$(this);var input=obj.children('input[type="hidden"]');var attrs=input.attr();if(attrs.disabled||obj.disabled()){return}var defDt={};$.loop(Fd,function(val,k){var v=attrs[val];if(v){v=v.split(":");defDt[k]={id:v[0],name:v[1],level:k,field:val}}});obj.area(attrs.title,defDt,function(dt){if(!dt.isEnd){return}obj.removeAttr("province city area town");var valueAttr={};$.loop(dt.data,function(val){var tname=name?name+"["+val.field+"]":val.field;valueAttr[val.field]=val.id+":"+val.name;obj.children('span[level="'+val.level+'"]').html(val.name+'<input type="hidden" name="'+tname+'[id]" value="'+val.id+'"><input type="hidden" name="'+tname+'[name]" value="'+val.name+'">')});input.attr(valueAttr)},maxlevel,attrs.api)});t.DOMchange("attr.disabled",function(){t.parent().disabled($(this).disabled())})});$.render('input[type="ks-pic"]',function(t){var t=$(t),attrs=t.attr();t.attr({type:"file",name:"",accept:"image/*",value:""});var isMultiple=/^.+\[\]$/g.test(attrs.name);var multipleMax=isMultiple?parseInt(attrs.maxlength||0):0;t.wrap("<ks-pic></ks-pic>").wrap('<label icon="add"></label>');var picObj=t.parent().parent();if(attrs.value){try{if(isMultiple){attrs.value=JSON.parse(attrs.value.replace(/'/g,'"'));var addI=0;$.loop(attrs.value,function(val){if(val.id){t.parent().parent().before("<ks-pic><ks-pic-thumb>"+'<img src="'+val.src+'">'+'<span icon="delete-bin-2-fill"></span>'+'<input type="hidden" name="'+attrs.name+'" value="'+val.id+'">'+"</ks-pic-thumb></ks-pic>");addI++}if(multipleMax>0&&addI>=multipleMax){picObj.hide()}})}else{t.parent().before('<ks-pic-thumb><img src="'+attrs.value+'"></ks-pic-thumb>')}}catch(e){}}function _inset(picList){var h="";if(isMultiple){$.loop(picList,function(value){h+="<ks-pic><ks-pic-thumb>"+'<img src="'+value.src+'">'+'<input type="hidden" name="'+attrs.name+'" value="tmp:'+value.aid+'">'+'<span icon="delete-bin-2-fill" delapi="'+attrs.api+"Del?aid="+value.aid+'"></span>'+"</ks-pic-thumb></ks-pic>"});picObj.before(h);if(multipleMax>0&&picObj.prevAll("ks-pic").length==multipleMax){picObj.hide()}}else{$.loop(picList,function(value){h+="<ks-pic-thumb>"+'<img src="'+value.src+'">'+'<input type="hidden" name="'+attrs.name+'" value="'+value.aid+'">'+"</ks-pic-thumb>"});var label=t.parent();label.prev().remove();label.before(h)}t.val("")}t.change(function(){if(!attrs.api){$.toast("组件缺少api属性");return false}if(attrs.zoomhidth||attrs.zoomheight||attrs.zoom){$.imgZoom(this,attrs.zoomwidth||1920,attrs.zoomweight||1080,function(blob){$.upload("upload",blob,attrs.api,function(dt){_inset(dt.List)})})}else{$.upload("upload",t[0],attrs.api,function(dt){_inset(dt.List)})}})});$.render('input[type="ks-file"]',function(t){var t=$(t),attrs=t.attr();t.attr("type","file").css("display","none");t.wrap("<ks-btn upload></ks-btn>").wrap('<label icon="upload-cloud-fill" style="display:block"></label>')});$.render('input[type="ks-files"]',function(t){var t=$(t),attrs=t.attr();var fname=attrs.name;fname=fname?fname+"[]":"";t.attr("type","file").css("display","none").attr("name",fname+"[]");t.wrap("<ks-btn upload></ks-btn>").wrap('<label icon="upload-cloud-fill" style="display:block"></label>')});$(document).on("click","ks-pic-thumb > span[icon*=delete]",function(){var ths=$(this),delApi=ths.attr("delapi");$.Dialog("confirm","操作提示","确认要删除该文件吗？",function(){if(delApi){$.API(delApi,"",function(res){ths.parent().parent().nextAll("ks-pic").show();res.success&&ths.parent().parent().remove()})}else{ths.parent().parent().nextAll("ks-pic").show();ths.parent().parent().remove()}})});$.render("ks-star",function(ele){var ele=$(ele),attr=ele.attr(),value=parseInt(attr.value||0);var h="";$.loop(parseInt(attr.max||5),function(i){h+='<i icon="star-fill" '+(value==i?"active":"")+"></i>"});ele.html(h)},"attr.value");$.render(".ks-slide",function(ele){ele=$(ele);var sdt=ele.attr();ele.slide({auto:sdt.auto,card:sdt.card,control:sdt.control,status:sdt.status})});$.render("table.ks-table",function(ele){},"html");$.render("table.ks-table[fixed-height]",function(ele){ele=$(ele);var fixedHeight=parseInt(ele.attr("fixed-height"))||0;if(!fixedHeight){return}ele.attr("fixed-height","");var thead=ele.children("thead");var allWidth=ele.width(true);var dom=$('<div class="ks-table-fixed-header"><div class="ks-table-header"></div><div class="ks-table-body" style="overflow-y: scroll; max-height:'+fixedHeight+'px"></div></div>');var rowCols=ele.children().eq(0).children().children();var rowColsNum=rowCols.length-1;var colgroup="<colgroup>";rowCols.each(function(index,el){if(index===rowColsNum){return}var w=$(el).width(true)/allWidth*100;colgroup+='<col style="width:'+w+"%; min-width: "+w+'%">'});colgroup+="</colgroup>";ele.after(dom);dom.find(".ks-table-header").html('<table class="'+ele.attr("class")+'">'+colgroup+"</table>").find("table").append(thead);dom.find(".ks-table-body").append(ele[0]).find("table").prepend(colgroup);var scrollWidth=dom.find(".ks-table-body").width(true)-dom.find(".ks-table-body > table").width(true);var scrollTd=document.createElement("td");scrollTd.style.width=scrollWidth+"px";scrollTd.className="ks-td-scroll";dom.find(".ks-table-header > table > thead > tr").append(scrollTd)});$.render("ks-form",function(dom){dom=$(dom);var domInline=$.isset(dom.attr("inline")),labelWidth=dom.attr("label-width");dom.find("ks-form-item").map(function(ele){if(ele._ksa_render_ks_form_item){return}ele._ksa_render_ks_form_item=1;ele=$(ele);var attrs=ele.attr();!domInline&&ele.addClass("ks-clear");ele.wrapInner("<ks-form-content></ks-form-content>");attrs.label&&ele.prepend("<ks-form-label "+($.isset(attrs.required)?"required":"")+">"+attrs.label+"</ks-form-label>");attrs.extra&&ele.append("<ks-form-extra>"+attrs.extra+"</ks-form-extra>");ele.attr({label:"",extra:"",required:""});if(labelWidth){labelWidth=$.isNumber(labelWidth)?labelWidth+"px":labelWidth;ele.find("ks-form-label").width(labelWidth);ele.find("ks-form-content , ks-form-extra").width("calc(100% - "+labelWidth+")")}})});$.render("ks-btn[submit]",function(dom){dom=$(dom);var submits=dom.attr("submit");var form=submits?$(submits):dom.parents("form");if(form.length){dom.click(function(){!dom.disabled()&&form.submit()});form.keyup(function(e){if(e.keyCode==13){form.submit()}})}});$.render("ks-btn[reset]",function(dom){dom=$(dom);var resets=dom.attr("reset");dom.attr("reset","");var form=resets?$(resets):dom.parents("form");if(!form.length){form=dom.parents("ks-form")}if(form.length){dom.click(function(){form.find('input:not([type="hidden"]), select, textarea').val("");form.find("select").attr("value","")})}});$.render("ks-collapse",function(ele){$(ele).children().map(function(el){el=$(el);var attr=el.attr();el.wrapInner("<ks-collapse-block></ks-collapse-block>").wrapInner("<ks-collapse-content></ks-collapse-content>");el.prepend("<ks-collapse-title>"+(attr.label||"")+"</ks-collapse-title>");var Pt=el.parent(),isAccordion=$.isset(Pt.attr("accordion"));var content=el.children("ks-collapse-content");if(el.active()){content.height(content.children("ks-collapse-block").height(true,true))}el.children("ks-collapse-title").click(function(){var maxH=content.children("ks-collapse-block").height(true,true);if(el.active()){content.height(0);el.active(false)}else{content.height(maxH);el.active(true);var acList=isAccordion?el.siblings():!!0;if(acList){acList.active(false);acList.children("ks-collapse-content").height(0)}}})})});$.render("ks-price",function(ele){ele=$(ele);function _inup(v){var txtele=ele.contents();var txt=v?v:txtele.eq(0).text().trim();txt=txt.toString();txtele.map(function(){this.textContent=""});txtele.nextAll("",1).remove();txt=txt.replace(/([^\s0-9\.]+)/gi,"<unit>$1</unit>");txt=txt.replace(/(\.[0-9]+)/g,"<small>$1</small>");if($.isset(ele.attr("split"))){txt=txt.replace(/([0-9]+)\.?/,function(v){v=v.replace(/([0-9])([0-9]{3})$/g,"$1,$2");return""+v+""})}ele.append(txt)}var val=ele.attr("value");var unit=ele.attr("unit");if(unit){val=unit+val}_inup(val);ele.DOMchange("attr.value",function(str){_inup(str)})},"attr.value attr.unit");$.render("ks-card",function(ele,isMonitor){ele=$(ele);var attrs=ele.attr();var title=ele.children("ks-card-title");var content=ele.children("ks-card-content");if(!content.length){ele.wrapInner("<ks-card-content></ks-card-content>");title.length&&ele.prepend(title)}if(title.length){if(isMonitor){if(attrs.label){title.html(attrs.label)}else{title.remove()}}}else if(attrs.label){ele.prepend($.tag("ks-card-title",{icon:attrs.icon},$.tag("div",{class:"ks-fl"},attrs.label)))}},"attr.label");$.render("ks-alert",function(ele){var ele=$(ele),attrs=ele.attr(),isClose=$.isset(attrs.close);var prehtml="";if(attrs.title){prehtml+="<ks-alert-title>"+attrs.title+"</ks-alert-title>"}if(isClose){prehtml+='<ks-alert-close icon="close"></ks-alert-close>'}ele.prepend(prehtml);ele.attr("title","");if(isClose){ele.children("ks-alert-close").click(function(){ele.css("opacity","0");window.setTimeout(function(){ele.remove()},300)})}});$.render("ks-avatar",function(ele){ele=$(ele);var attr=ele.attr();var code="",label=attr.label&&!attr.src?attr.label:null;if(label){code=label}else if(attr.src){code='<img src="'+attr.src+'">'}else{code='<i icon="user"></i>'}ele.html(code)},"attr.label attr.src");$.render("ks-page",function(ele){function _pgTo(val,isInit){if(ele.disabled()||val==ele[0].value){return}if(val==="prev"){val=ele[0].value-1;val=val<1?1:val}else if(val==="next"){val=ele[0].value+1;val=val>total?total:val}val=parseInt(val);ele.children("ks-page-prev").disabled(val===1);ele.children("ks-page-first").disabled(val<pageNum/2);ele.children("ks-page-next").disabled(val===total);ele.children("ks-page-last").disabled(val>total-pageNum/2);ele.attr("current",val);ele[0].value=val;var startPg=val-(pageNum-1)/2;var endPg=total-pageNum+1;startPg=startPg>endPg?endPg:startPg;startPg=startPg<1?1:startPg;ele.children("a").map(function(a){$(a).attr("value",startPg).text(startPg);startPg++});ele.children('a[value="'+val+'"]').active(true).siblings("a").active(false);ele.find(".ks-input-group > input").val(val);!isInit&&ele.trigger("change")}ele=$(ele);var total=parseInt(ele.attr("total")||0);if(!total){return}var current=parseInt(ele.attr("current")||1);var pageNum=parseInt(ele.attr("numbers")||5);var href=ele.attr("href");var pgcode="";(function(){var start=Math.ceil(current-(pageNum-1)/2);start=start<1?1:start;var mx=Math.min(total+1,start+pageNum);if(mx<=2){return}for(var i=start;i<mx;i++){pgcode+=$.tag("a",{active:current===i?true:null,value:i,href:href?href.replace("{{page}}",val):null},i)}})();if(!pgcode){return}var H='<ks-page-first icon="arrow-left" value="1"></ks-page-first><ks-page-prev icon="arrow-left-s" value="prev"></ks-page-prev>';H+=pgcode;H+='<ks-page-next icon="arrow-right-s" value="next"></ks-page-next><ks-page-last icon="arrow-right" value="'+total+'"></ks-page-last>';if($.isset(ele.attr("quick"))){H+='<ks-input-group><i>转</i><input type="text" value="'+current+'"><i>页</i></ks-input-group>'}ele.html(H);_pgTo(current,true);ele.children("*:not(ks-input-group)").click(function(){var el=$(this);if(el.disabled()){return}_pgTo(el.attr("value"))});ele.find("ks-input-group > input").keyup(function(e){if(e.keyCode===13){_pgTo(this.value)}}).focus(function(){$(this).select()})},"attr.total attr.current");$.render("ks",function(ele){ele=$(ele);if(ele.children("ks-side").length){ele.css("flex-direction","row")}});$.render("ks-navbar",function(ele){ele=$(ele);var ks=ele.parent("ks");ks.attr("navbar",true);var navbarItem=ele.children("ks-navbar-item");var contents=ks.children("ks-content").children("ks-navbar-content");function _navbarContentShow(el,key){contents.filter('[key="'+key+'"]').show().siblings().hide()}navbarItem.each(function(i,el){el=$(el);var href=el.attr("href");if(href){el.click(function(){window.location.href=href})}var skey=el.attr("key");if(el.active()){_navbarContentShow(el,skey)}el.click(function(){$(this).active(true)}).DOMchange("attr.active",function(){var el=$(this);if(el.active()){el.siblings().active(false);_navbarContentShow(el,skey)}})})});$.render("ks-row",function(ele){ele=$(ele);if(ele.children("ks-col").length){ele.attr("flex",true)}});$.render("ks-tab",function(ele){ele=$(ele);function _titleStatus(N){N=N>=0?N:0;title_item.eq(N).active(true).siblings().active(false)}var isTouch=$.isset(ele.attr("touch"));var title=ele.children("ks-tab-title");var title_item=title.children("ks-tab-title-item");var contentBox=ele.children("ks-tab-content");var content_item=ele.find("ks-tab-item");var itemLength=content_item.length;if(!title.length){title=$("<ks-tab-title></ks-tab-title>");content_item.each(function(i,el){el=$(el);title.append($.tag("ks-tab-title-item",{active:el.active()},el.attr("label")||i))});ele.prepend(title);title_item=title.children("ks-tab-title-item")}if(!contentBox.length){content_item.wrapAll("<ks-tab-content></ks-tab-content>");contentBox=ele.children("ks-tab-content")}var currIndex=title_item.filter("[active]").index()||0,moveX=0,eleWidth=ele.width(true),touchMaxWidth=itemLength*eleWidth;contentBox.addClass("ks-clear");function _play(N){N=parseInt(N||0);moveX=0-eleWidth*N;isTouch?contentBox.removeClass("ks-no-transition").css({transform:"translateX("+moveX+"px)"}):content_item.eq(N).show().active(true).siblings().hide().active(false)}title_item.click(function(){if(!$(this).active()){_titleStatus($(this).index())}}).DOMchange("attr.active",function(){var ths=$(this);if(ths.active()){var i=ths.index();_play(i)}});if(isTouch){contentBox.wrap("<ks-tab-touch-content></ks-tab-touch-content>");contentBox.width(touchMaxWidth);content_item.width(eleWidth);ele.children("ks-tab-touch-content").touch(function(){},function(evn,touch){if(touch.action==="left"||touch.action==="right"){var mx=moveX+touch.moveX;var max=0-(touchMaxWidth-eleWidth);mx=mx>0?0:mx<max?max:mx;contentBox.addClass("ks-no-transition").css({transform:"translateX("+mx+"px)"})}},function(evn,touch){if(currIndex<itemLength-1&&touch.action=="left"){currIndex++;title_item.eq(currIndex).trigger("click")}else if(currIndex>0&&touch.action=="right"){currIndex--;title_item.eq(currIndex).trigger("click")}else{contentBox.removeClass("ks-no-transition").css({transform:"translateX("+moveX+"px)"})}},"X")}_play(currIndex);_titleStatus(currIndex)},"html");$.render("ks-tag[close], ks-tag[edit]",function(ele){ele=$(ele);var attr=ele.attr();ele.wrapInner("<span></span>");if(attr.edit){var input=$('<input type="hidden" value="'+ele.text()+'">');input.blur(function(){var val=input.val();input.attr("type","hidden");input.prev().css("opacity","").text(val);$.callStrEvent.call(ele[0],attr.edit,val)});ele.append(input);ele.click(function(){input.prev().css("opacity","0");input.attr("type","text").focus().select()})}if($.isset(attr.close)){var btn=$('<i icon="close"></i>');btn.click(function(evn){var x;attr.close&&(x=$.callStrEvent.call(ele[0],attr.close,evn));x!==false&&ele.remove();return false});ele.append(btn)}});$.render("[title]",function(ele){ele=$(ele);var tit=ele.attr("title");if(tit){ele.hover(function(){$.showTip(ele);ele.attr("title","")},function(){ele.attr("title",tit)})}});$.render("[icon]",function(ele){var icon=ele.attributes.icon.value;if(icon){ele.className+=" ri-"+icon}})})();_KSArenderStart()})(KSA);