if("undefined"==typeof KSA)throw Error("KSA\u7ec4\u4ef6\u7f3a\u5931 admin.js");$.layerHideBackEvent=!1;$.AddTags="ks-date ks-datetime ks-button ks-menu ks-window ks-input".split(" ");$.adminUrl=function(f){return f=$.urlAdd(f,{_adminiframe_:1})};$.adminiframeWin=function(f,b,c){$.layer({title:f,iframe:this.adminUrl(b),width:"90%",height:"90%",maxHeight:!1,close:function(a){"function"==typeof c&&c(a)}})};$.adminAjaxSubmit=function(f){return $.ajaxSubmit(f,function(b){b.success&&setTimeout($.layerHideF,1600)})};function KSAadminIframe(f){return{dom:$("#content"),taskBar:$(".ks-admin-taskbar"),bar:"",menu:$(".ks-sidebar_box"),navaction:$("ks-navaction"),home:$(".ks-admin-taskbar-home"),homeUrl:f,isArrow:!1,taskBarContentWidth:0,taskBarWidth:0,taskBarLeft:0,currentUrl:"",data:{},run:function(){var b=this;b.bar=b.taskBar.children(".ks-admin-taskbar-c");b.homeUrl=b.homeUrl?b.homeUrl:b.home.data("url");b.initTaskBarParam();b.home.click(function(){b.change("home")});$(".ks-sidebar_box dl").each(function(a,c){c=$(c);c.find(".ks-sidebar_title").click(function(){var a=$(this).parent();a.active()?a.active(!1):a.active(!0)});c.find("[data-url]").click(function(){var a=$(this);b.open(a.data("url"),1,a.text());b.taskbarMove()})});var c=b.cache();$.count(c)?$.loop(c,function(a){a&&a.url&&a.title&&b.open(a.url,a.isOpen,a.title)}):b.open(b.homeUrl,1,"home");$(".ks-admin-taskbar-next").mousedown(function(){b.taskbarMove("left");this._ksa_taskbarMove=window.setInterval(function(){b.taskbarMove("left")},200)}).mouseup(function(){window.clearInterval(this._ksa_taskbarMove);delete this._ksa_taskbarMove}).showMenu("hover",[{label:"\u5173\u95ed\u5f53\u524d\u6807\u7b7e",event:function(){b.close(b.bar.find("li[active]").data("url"))}},{label:"\u5173\u95ed\u6240\u6709\u6807\u7b7e",event:function(){b.closeAll()}}]);$(".ks-admin-taskbar-prev").mousedown(function(){b.taskbarMove("right");this._ksa_taskbarMove=window.setInterval(function(){b.taskbarMove("right")},200)}).mouseup(function(){window.clearInterval(this._ksa_taskbarMove);delete this._ksa_taskbarMove});b.taskbarMove();b.createIframe(b.currentUrl);b.change(b.currentUrl);return b},initTaskBarParam:function(){this.taskBarWidth=this.bar.width(!0);this.taskBarLeft=this.bar.offset().left},taskbarMove:function(b){var c=this,a,d=parseFloat(c.bar.children("ul").css("left"))||0,e=null;if("right"===b)c.bar.find("li").each(function(b,d){0>c.getTaskItemLeft(d)&&(a=d)});else if("left"===b)c.bar.find("li").each(function(b,d){var e=c.getTaskItemLeft(d)+$(d).width(!0);!a&&e>c.taskBarWidth&&(a=d)});else{if(c.currentUrl===c.homeUrl)return;a=c.data[c.currentUrl].taskBar}a&&(a=$(a),b=c.getTaskItemLeft(a),0>b?e=d-b:b+a.width(!0)>c.taskBarWidth&&(e=d-(b+a.width(!0)-c.taskBarWidth)),$.isNull(e)||(d=-(c.taskBarContentWidth-c.taskBarWidth),e=0>e&&e<d?d:e,e=0<e?0:e,c.bar.children("ul").css("left",e+"px")))},getTaskItemLeft:function(b){return $(b).offset().left-this.taskBarLeft},change:function(b,c){var a=this;a.currentUrl=b;b===a.homeUrl||"home"===b?(a.home.active(!0),a.bar.find("li").active(!1),b=a.homeUrl):a.home.active(!1);var d=a.data[b];d&&(d.content&&d.param==c||a.createIframe(b,c),$(d.content).active(!0).siblings().active(!1),$(d.taskBar).active(!0).siblings().active(!1),this.currentIframe=$(d.content).find("iframe"),a.cache(b,d.title),$.loop(a.data,function(b,c){a.data[c].isShow=!1}),a.data[b].isShow=!0);a.muChange(b)},muChange:function(b){var c=this;b=c.menu.find('[data-url\x3d"'+b+'"]');c.menu.find("dl, dd, dt, li, li \x3e p").active(!1);b.active(!0);b.parents("dl").active(!0);b.parent().parents("li").active(!0);var a=$('\x3ca href\x3d"javascript:;"\x3e\u9996\u9875\x3c/a\x3e');a.click(function(){c.open(c.homeUrl,1,"home")});c.navaction.empty().append(a);b.parents("dl").find("[active] \x3e .ks-sidebar_title").push(b).map(function(a){c.navaction.append("\x3cspan\x3e"+$(a).text()+"\x3c/span\x3e")})},cache:function(b,c){var a=$.Cache("adminframe")||{};b&&(""===c?a=$.unset(a,b):($.loop(a,function(b,c){a[c].isOpen=0}),a[b]?a[b].isOpen=1:a[b]={title:c,url:b,isOpen:1}),$.Cache("adminframe",a));return a},createIframe:function(b,c){var a=b;c&&$.isObject(c)&&(a=$.urlAdd(b,c));if(this.data[b]&&this.data[b].content){var d=$(this.data[b].content).find("iframe");c&&d.attr("src")!=a&&d.attr("src",$.adminUrl(a));return this.data[b].content}a=$('\x3cdiv class\x3d"ks-admin-iframe" data-url\x3d"'+b+'"\x3e\x3ciframe src\x3d"'+$.adminUrl(a)+'" width\x3d"100%" height\x3d"100%"\x3e\x3c/iframe\x3e\x3c/div\x3e');this.data[b].content=a[0];this.dom.append(a);this.currentIframe=a.find("iframe");return a},createTaskbar:function(b,c){var a=this;if(a.data[c]&&a.data[c].taskBar)return a.data[c].taskBar;if(c===a.homeUrl)return a.data[c].taskBar=a.home[0],a.home;var d=$($.tag("li",{"class":"ks-admin-taskbar-li","data-title":b,"data-url":c},b+'\x3ci icon\x3d"close"\x3e\x3c/i\x3e'));d.click(function(){a.change($(this).data("url"));a.taskbarMove(this)});d.find("i").click(function(){a.close($(this).parent().data("url"));return!1});d.dblclick(function(){a.currentIframe[0].contentWindow.location.reload(!0)});a.bar.children("ul").append(d);a.taskBarContentWidth+=d.width(!0,!0);!a.isArrow&&a.taskBarContentWidth>a.taskBarWidth&&(a.isArrow=!0,a.taskBar.attr("more",!0),a.initTaskBarParam());a.data[c].taskBar=d[0];return d},open:function(b,c,a,d){a||(a=this.menu.find('[data-url\x3d"'+b+'"]').text());this.data[b]||(this.data[b]={title:a,isShow:c,taskBar:"",content:""});this.createTaskbar(a,b);c&&this.change(b,d)},close:function(b,c){var a=this,d=a.data[b];if(d){var e=$(d.taskBar),f=$(d.content);!c&&f.length&&$(f.children("iframe")[0].contentWindow.document.body).find('.ks-layer:not([pos\x3d"0"])').length?$.Dialog("confirm","\u7a97\u53e3\u5173\u95ed\u63d0\u793a","\u786e\u8ba4\u8981\u5173\u95ed"+d.title+"\u5417\uff1f",function(){a.close(b,!0)}):(a.taskBarContentWidth-=e.width(!0,!0),d=e.next(),d.length||(d=e.prev()),e.active()&&a.change(d.length?d.data("url"):"home"),a.isArrow&&a.taskBarContentWidth<a.taskBarWidth&&(a.isArrow=!1,a.taskBar.attr("more",""),a.initTaskBarParam()),e.remove(),f.length&&f.remove(),a.cache(b,""),delete a.data[b],a.initTaskBarParam())}},closeAll:function(){var b=this;b.bar.find("li").each(function(c,a){a=$(a);var d=a.data("url");b.data[d].content&&$(b.data[d].content).remove();a.remove();b.cache(d,"");delete b.data[d]});b.taskBar.attr("more","");b.change("home");b.isArrow=!1;b.taskBarContentWidth=0}}.run()};